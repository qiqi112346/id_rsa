/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.122.0
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

import{a as gr,b as dr}from"./chunk-NVQ5CDE4.js";import{a as ur}from"./chunk-RHBLVWYJ.js";import{a as Fe}from"./chunk-233CTMIC.js";import{a as hr}from"./chunk-4ITTDBSQ.js";import{a as Ne}from"./chunk-GNPBRUGD.js";import{a as mr}from"./chunk-T4N3OY6X.js";import{a as cr}from"./chunk-5HUHCMAV.js";import"./chunk-Q5EY7A6W.js";import"./chunk-F3ECIOUN.js";import{d as lr}from"./chunk-MIRRWMBE.js";import{b as ce,g as rr,i as me}from"./chunk-BJZJXGPI.js";import"./chunk-T5OKL2DM.js";import{a as N,c as Be,d as Le}from"./chunk-CDTBDMY4.js";import{a as Te}from"./chunk-LX4R5T4O.js";import"./chunk-YJOCDLI3.js";import{a as er}from"./chunk-3DX4WCAY.js";import{a as Z}from"./chunk-CDG5PL45.js";import{a as ye}from"./chunk-B3GSTU5G.js";import{c as Ar,d as Dr,e as $}from"./chunk-UQOFARAR.js";var pr=Ar((ti,be)=>{/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var S=function(){var E={};E.defaultNoDataValue=-34027999387901484e22,E.decode=function(r,a){a=a||{};var t=a.encodedMaskData||a.encodedMaskData===null,i=n(r,a.inputOffset||0,t),l=a.noDataValue!==null?a.noDataValue:E.defaultNoDataValue,o=A(i,a.pixelType||Float32Array,a.encodedMaskData,l,a.returnMask),c={width:i.width,height:i.height,pixelData:o.resultPixels,minValue:o.minValue,maxValue:i.pixels.maxValue,noDataValue:l};return o.resultMask&&(c.maskData=o.resultMask),a.returnEncodedMask&&i.mask&&(c.encodedMaskData=i.mask.bitset?i.mask.bitset:null),a.returnFileInfo&&(c.fileInfo=H(i),a.computeUsedBitDepths&&(c.fileInfo.bitDepths=Q(i))),c};var A=function(r,a,t,i,l){var o=0,c=r.pixels.numBlocksX,h=r.pixels.numBlocksY,f=Math.floor(r.width/c),s=Math.floor(r.height/h),m=2*r.maxZError,u=Number.MAX_VALUE,g;t=t||(r.mask?r.mask.bitset:null);var d,U;d=new a(r.width*r.height),l&&t&&(U=new Uint8Array(r.width*r.height));for(var M=new Float32Array(f*s),y,p,k=0;k<=h;k++){var w=k!==h?s:r.height%h;if(w!==0)for(var v=0;v<=c;v++){var I=v!==c?f:r.width%c;if(I!==0){var V=k*r.width*s+v*f,T=r.width-I,x=r.pixels.blocks[o],B,b,L;x.encoding<2?(x.encoding===0?B=x.rawData:(e(x.stuffedData,x.bitsPerPixel,x.numValidPixels,x.offset,m,M,r.pixels.maxValue),B=M),b=0):x.encoding===2?L=0:L=x.offset;var Y;if(t)for(p=0;p<w;p++){for(V&7&&(Y=t[V>>3],Y<<=V&7),y=0;y<I;y++)V&7||(Y=t[V>>3]),Y&128?(U&&(U[V]=1),g=x.encoding<2?B[b++]:L,u=u>g?g:u,d[V++]=g):(U&&(U[V]=0),d[V++]=i),Y<<=1;V+=T}else if(x.encoding<2)for(p=0;p<w;p++){for(y=0;y<I;y++)g=B[b++],u=u>g?g:u,d[V++]=g;V+=T}else for(u=u>L?L:u,p=0;p<w;p++){for(y=0;y<I;y++)d[V++]=L;V+=T}if(x.encoding===1&&b!==x.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:d,resultMask:U,minValue:u}},H=function(r){return{fileIdentifierString:r.fileIdentifierString,fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,noDataValue:r.noDataValue}}},Q=function(r){for(var a=r.pixels.numBlocksX*r.pixels.numBlocksY,t={},i=0;i<a;i++){var l=r.pixels.blocks[i];l.encoding===0?t.float32=!0:l.encoding===1?t[l.bitsPerPixel]=!0:t[0]=!0}return Object.keys(t)},n=function(r,a,t){var i={},l=new Uint8Array(r,a,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,l),i.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+i.fileIdentifierString;a+=10;var o=new DataView(r,a,24);if(i.fileVersion=o.getInt32(0,!0),i.imageType=o.getInt32(4,!0),i.height=o.getUint32(8,!0),i.width=o.getUint32(12,!0),i.maxZError=o.getFloat64(16,!0),a+=24,!t)if(o=new DataView(r,a,16),i.mask={},i.mask.numBlocksY=o.getUint32(0,!0),i.mask.numBlocksX=o.getUint32(4,!0),i.mask.numBytes=o.getUint32(8,!0),i.mask.maxValue=o.getFloat32(12,!0),a+=16,i.mask.numBytes>0){var c=new Uint8Array(Math.ceil(i.width*i.height/8));o=new DataView(r,a,i.mask.numBytes);var h=o.getInt16(0,!0),f=2,s=0;do{if(h>0)for(;h--;)c[s++]=o.getUint8(f++);else{var m=o.getUint8(f++);for(h=-h;h--;)c[s++]=m}h=o.getInt16(f,!0),f+=2}while(f<i.mask.numBytes);if(h!==-32768||s<c.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=c,a+=i.mask.numBytes}else i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue||(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));o=new DataView(r,a,16),i.pixels={},i.pixels.numBlocksY=o.getUint32(0,!0),i.pixels.numBlocksX=o.getUint32(4,!0),i.pixels.numBytes=o.getUint32(8,!0),i.pixels.maxValue=o.getFloat32(12,!0),a+=16;var u=i.pixels.numBlocksX,g=i.pixels.numBlocksY,d=u+(i.width%u>0?1:0),U=g+(i.height%g>0?1:0);i.pixels.blocks=new Array(d*U);for(var M=0,y=0;y<U;y++)for(var p=0;p<d;p++){var k=0,w=r.byteLength-a;o=new DataView(r,a,Math.min(10,w));var v={};i.pixels.blocks[M++]=v;var I=o.getUint8(0);if(k++,v.encoding=I&63,v.encoding>3)throw"Invalid block encoding ("+v.encoding+")";if(v.encoding===2){a++;continue}if(I!==0&&I!==2){if(I>>=6,v.offsetType=I,I===2)v.offset=o.getInt8(1),k++;else if(I===1)v.offset=o.getInt16(1,!0),k+=2;else if(I===0)v.offset=o.getFloat32(1,!0),k+=4;else throw"Invalid block offset type";if(v.encoding===1)if(I=o.getUint8(k),k++,v.bitsPerPixel=I&63,I>>=6,v.numValidPixelsType=I,I===2)v.numValidPixels=o.getUint8(k),k++;else if(I===1)v.numValidPixels=o.getUint16(k,!0),k+=2;else if(I===0)v.numValidPixels=o.getUint32(k,!0),k+=4;else throw"Invalid valid pixel count type"}if(a+=k,v.encoding!==3){var V,T;if(v.encoding===0){var x=(i.pixels.numBytes-1)/4;if(x!==Math.floor(x))throw"uncompressed block has invalid length";V=new ArrayBuffer(x*4),T=new Uint8Array(V),T.set(new Uint8Array(r,a,x*4));var B=new Float32Array(V);v.rawData=B,a+=x*4}else if(v.encoding===1){var b=Math.ceil(v.numValidPixels*v.bitsPerPixel/8),L=Math.ceil(b/4);V=new ArrayBuffer(L*4),T=new Uint8Array(V),T.set(new Uint8Array(r,a,b)),v.stuffedData=new Uint32Array(V),a+=b}}}return i.eofOffset=a,i},e=function(r,a,t,i,l,o,c){var h=(1<<a)-1,f=0,s,m=0,u,g,d=Math.ceil((c-i)/l),U=r.length*4-Math.ceil(a*t/8);for(r[r.length-1]<<=8*U,s=0;s<t;s++){if(m===0&&(g=r[f++],m=32),m>=a)u=g>>>m-a&h,m-=a;else{var M=a-m;u=(g&h)<<M&h,g=r[f++],m=32-M,u+=g>>>m}o[s]=u<d?i+u*l:c}return o};return E}(),he=function(){"use strict";var E={unstuff:function(n,e,r,a,t,i,l,o){var c=(1<<r)-1,h=0,f,s=0,m,u,g,d,U=n.length*4-Math.ceil(r*a/8);if(n[n.length-1]<<=8*U,t)for(f=0;f<a;f++)s===0&&(u=n[h++],s=32),s>=r?(m=u>>>s-r&c,s-=r):(g=r-s,m=(u&c)<<g&c,u=n[h++],s=32-g,m+=u>>>s),e[f]=t[m];else for(d=Math.ceil((o-i)/l),f=0;f<a;f++)s===0&&(u=n[h++],s=32),s>=r?(m=u>>>s-r&c,s-=r):(g=r-s,m=(u&c)<<g&c,u=n[h++],s=32-g,m+=u>>>s),e[f]=m<d?i+m*l:o},unstuffLUT:function(n,e,r,a,t,i){var l=(1<<e)-1,o=0,c=0,h=0,f=0,s=0,m,u=[],g=n.length*4-Math.ceil(e*r/8);n[n.length-1]<<=8*g;var d=Math.ceil((i-a)/t);for(c=0;c<r;c++)f===0&&(m=n[o++],f=32),f>=e?(s=m>>>f-e&l,f-=e):(h=e-f,s=(m&l)<<h&l,m=n[o++],f=32-h,s+=m>>>f),u[c]=s<d?a+s*t:i;return u.unshift(a),u},unstuff2:function(n,e,r,a,t,i,l,o){var c=(1<<r)-1,h=0,f,s=0,m=0,u,g,d;if(t)for(f=0;f<a;f++)s===0&&(g=n[h++],s=32,m=0),s>=r?(u=g>>>m&c,s-=r,m+=r):(d=r-s,u=g>>>m&c,g=n[h++],s=32-d,u|=(g&(1<<d)-1)<<r-d,m=d),e[f]=t[u];else{var U=Math.ceil((o-i)/l);for(f=0;f<a;f++)s===0&&(g=n[h++],s=32,m=0),s>=r?(u=g>>>m&c,s-=r,m+=r):(d=r-s,u=g>>>m&c,g=n[h++],s=32-d,u|=(g&(1<<d)-1)<<r-d,m=d),e[f]=u<U?i+u*l:o}return e},unstuffLUT2:function(n,e,r,a,t,i){var l=(1<<e)-1,o=0,c=0,h=0,f=0,s=0,m=0,u,g=[],d=Math.ceil((i-a)/t);for(c=0;c<r;c++)f===0&&(u=n[o++],f=32,m=0),f>=e?(s=u>>>m&l,f-=e,m+=e):(h=e-f,s=u>>>m&l,u=n[o++],f=32-h,s|=(u&(1<<h)-1)<<e-h,m=h),g[c]=s<d?a+s*t:i;return g.unshift(a),g},originalUnstuff:function(n,e,r,a){var t=(1<<r)-1,i=0,l,o=0,c,h,f,s=n.length*4-Math.ceil(r*a/8);for(n[n.length-1]<<=8*s,l=0;l<a;l++)o===0&&(h=n[i++],o=32),o>=r?(c=h>>>o-r&t,o-=r):(f=r-o,c=(h&t)<<f&t,h=n[i++],o=32-f,c+=h>>>o),e[l]=c;return e},originalUnstuff2:function(n,e,r,a){var t=(1<<r)-1,i=0,l,o=0,c=0,h,f,s;for(l=0;l<a;l++)o===0&&(f=n[i++],o=32,c=0),o>=r?(h=f>>>c&t,o-=r,c+=r):(s=r-o,h=f>>>c&t,f=n[i++],o=32-s,h|=(f&(1<<s)-1)<<r-s,c=s),e[l]=h;return e}},A={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(n){for(var e=65535,r=65535,a=n.length,t=Math.floor(a/2),i=0;t;){var l=t>=359?359:t;t-=l;do e+=n[i++]<<8,r+=e+=n[i++];while(--l);e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16)}return a&1&&(r+=e+=n[i]<<8),e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16),(r<<16|e)>>>0},readHeaderInfo:function(n,e){var r=e.ptr,a=new Uint8Array(n,r,6),t={};if(t.fileIdentifierString=String.fromCharCode.apply(null,a),t.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+t.fileIdentifierString;r+=6;var i=new DataView(n,r,8),l=i.getInt32(0,!0);t.fileVersion=l,r+=4,l>=3&&(t.checksum=i.getUint32(4,!0),r+=4),i=new DataView(n,r,12),t.height=i.getUint32(0,!0),t.width=i.getUint32(4,!0),r+=8,l>=4?(t.numDims=i.getUint32(8,!0),r+=4):t.numDims=1,i=new DataView(n,r,40),t.numValidPixel=i.getUint32(0,!0),t.microBlockSize=i.getInt32(4,!0),t.blobSize=i.getInt32(8,!0),t.imageType=i.getInt32(12,!0),t.maxZError=i.getFloat64(16,!0),t.zMin=i.getFloat64(24,!0),t.zMax=i.getFloat64(32,!0),r+=40,e.headerInfo=t,e.ptr=r;var o,c;if(l>=3&&(c=l>=4?52:48,o=this.computeChecksumFletcher32(new Uint8Array(n,r-c,t.blobSize-14)),o!==t.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(n,e){var r=e.headerInfo,a=this.getDataTypeArray(r.imageType),t=r.numDims*this.getDataTypeSize(r.imageType),i=this.readSubArray(n,e.ptr,a,t),l=this.readSubArray(n,e.ptr+t,a,t);e.ptr+=2*t;var o,c=!0;for(o=0;o<r.numDims;o++)if(i[o]!==l[o]){c=!1;break}return r.minValues=i,r.maxValues=l,c},readSubArray:function(n,e,r,a){var t;if(r===Uint8Array)t=new Uint8Array(n,e,a);else{var i=new ArrayBuffer(a),l=new Uint8Array(i);l.set(new Uint8Array(n,e,a)),t=new r(i)}return t},readMask:function(n,e){var r=e.ptr,a=e.headerInfo,t=a.width*a.height,i=a.numValidPixel,l=new DataView(n,r,4),o={};if(o.numBytes=l.getUint32(0,!0),r+=4,(i===0||t===i)&&o.numBytes!==0)throw"invalid mask";var c,h;if(i===0)c=new Uint8Array(Math.ceil(t/8)),o.bitset=c,h=new Uint8Array(t),e.pixels.resultMask=h,r+=o.numBytes;else if(o.numBytes>0){c=new Uint8Array(Math.ceil(t/8)),l=new DataView(n,r,o.numBytes);var f=l.getInt16(0,!0),s=2,m=0,u=0;do{if(f>0)for(;f--;)c[m++]=l.getUint8(s++);else for(u=l.getUint8(s++),f=-f;f--;)c[m++]=u;f=l.getInt16(s,!0),s+=2}while(s<o.numBytes);if(f!==-32768||m<c.length)throw"Unexpected end of mask RLE encoding";h=new Uint8Array(t);var g=0,d=0;for(d=0;d<t;d++)d&7?(g=c[d>>3],g<<=d&7):g=c[d>>3],g&128&&(h[d]=1);e.pixels.resultMask=h,o.bitset=c,r+=o.numBytes}return e.ptr=r,e.mask=o,!0},readDataOneSweep:function(n,e,r){var a=e.ptr,t=e.headerInfo,i=t.numDims,l=t.width*t.height,o=t.imageType,c=t.numValidPixel*A.getDataTypeSize(o)*i,h,f=e.pixels.resultMask;if(r===Uint8Array)h=new Uint8Array(n,a,c);else{var s=new ArrayBuffer(c),m=new Uint8Array(s);m.set(new Uint8Array(n,a,c)),h=new r(s)}if(h.length===l*i)e.pixels.resultPixels=h;else{e.pixels.resultPixels=new r(l*i);var u=0,g=0,d=0,U=0;if(i>1)for(d=0;d<i;d++)for(U=d*l,g=0;g<l;g++)f[g]&&(e.pixels.resultPixels[U+g]=h[u++]);else for(g=0;g<l;g++)f[g]&&(e.pixels.resultPixels[g]=h[u++])}return a+=c,e.ptr=a,!0},readHuffmanTree:function(n,e){var r=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(n,e.ptr,16);e.ptr+=16;var t=a.getInt32(0,!0);if(t<2)throw"unsupported Huffman version";var i=a.getInt32(4,!0),l=a.getInt32(8,!0),o=a.getInt32(12,!0);if(l>=o)return!1;var c=new Uint32Array(o-l);A.decodeBits(n,e,c);var h=[],f,s,m,u;for(f=l;f<o;f++)s=f-(f<i?0:i),h[s]={first:c[f-l],second:null};var g=n.byteLength-e.ptr,d=Math.ceil(g/4),U=new ArrayBuffer(d*4),M=new Uint8Array(U);M.set(new Uint8Array(n,e.ptr,g));var y=new Uint32Array(U),p=0,k,w=0;for(k=y[0],f=l;f<o;f++)s=f-(f<i?0:i),u=h[s].first,u>0&&(h[s].second=k<<p>>>32-u,32-p>=u?(p+=u,p===32&&(p=0,w++,k=y[w])):(p+=u-32,w++,k=y[w],h[s].second|=k>>>32-p));var v=0,I=0,V=new H;for(f=0;f<h.length;f++)h[f]!==void 0&&(v=Math.max(v,h[f].first));v>=r?I=r:I=v,v>=30&&console.log("WARning, large NUM LUT BITS IS "+v);var T=[],x,B,b,L,Y,C;for(f=l;f<o;f++)if(s=f-(f<i?0:i),u=h[s].first,u>0)if(x=[u,s],u<=I)for(B=h[s].second<<I-u,b=1<<I-u,m=0;m<b;m++)T[B|m]=x;else for(B=h[s].second,C=V,L=u-1;L>=0;L--)Y=B>>>L&1,Y?(C.right||(C.right=new H),C=C.right):(C.left||(C.left=new H),C=C.left),L===0&&!C.val&&(C.val=x[1]);return{decodeLut:T,numBitsLUTQick:I,numBitsLUT:v,tree:V,stuffedData:y,srcPtr:w,bitPos:p}},readHuffman:function(n,e,r){var a=e.headerInfo,t=a.numDims,i=e.headerInfo.height,l=e.headerInfo.width,o=l*i,c=this.readHuffmanTree(n,e),h=c.decodeLut,f=c.tree,s=c.stuffedData,m=c.srcPtr,u=c.bitPos,g=c.numBitsLUTQick,d=c.numBitsLUT,U=e.headerInfo.imageType===0?128:0,M,y,p,k=e.pixels.resultMask,w,v,I,V,T,x,B,b=0;u>0&&(m++,u=0);var L=s[m],Y=e.encodeMode===1,C=new r(o*t),R=C,q;for(q=0;q<a.numDims;q++){if(t>1&&(R=new r(C.buffer,o*q,o),b=0),e.headerInfo.numValidPixel===l*i)for(x=0,V=0;V<i;V++)for(T=0;T<l;T++,x++){if(y=0,w=L<<u>>>32-g,v=w,32-u<g&&(w|=s[m+1]>>>64-u-g,v=w),h[v])y=h[v][1],u+=h[v][0];else for(w=L<<u>>>32-d,v=w,32-u<d&&(w|=s[m+1]>>>64-u-d,v=w),M=f,B=0;B<d;B++)if(I=w>>>d-B-1&1,M=I?M.right:M.left,!(M.left||M.right)){y=M.val,u=u+B+1;break}u>=32&&(u-=32,m++,L=s[m]),p=y-U,Y?(T>0?p+=b:V>0?p+=R[x-l]:p+=b,p&=255,R[x]=p,b=p):R[x]=p}else for(x=0,V=0;V<i;V++)for(T=0;T<l;T++,x++)if(k[x]){if(y=0,w=L<<u>>>32-g,v=w,32-u<g&&(w|=s[m+1]>>>64-u-g,v=w),h[v])y=h[v][1],u+=h[v][0];else for(w=L<<u>>>32-d,v=w,32-u<d&&(w|=s[m+1]>>>64-u-d,v=w),M=f,B=0;B<d;B++)if(I=w>>>d-B-1&1,M=I?M.right:M.left,!(M.left||M.right)){y=M.val,u=u+B+1;break}u>=32&&(u-=32,m++,L=s[m]),p=y-U,Y?(T>0&&k[x-1]?p+=b:V>0&&k[x-l]?p+=R[x-l]:p+=b,p&=255,R[x]=p,b=p):R[x]=p}e.ptr=e.ptr+(m+1)*4+(u>0?4:0)}e.pixels.resultPixels=C},decodeBits:function(n,e,r,a,t){{var i=e.headerInfo,l=i.fileVersion,o=0,c=new DataView(n,e.ptr,5),h=c.getUint8(0);o++;var f=h>>6,s=f===0?4:3-f,m=(h&32)>0,u=h&31,g=0;if(s===1)g=c.getUint8(o),o++;else if(s===2)g=c.getUint16(o,!0),o+=2;else if(s===4)g=c.getUint32(o,!0),o+=4;else throw"Invalid valid pixel count type";var d=2*i.maxZError,U,M,y,p,k,w,v,I,V,T,x=i.numDims>1?i.maxValues[t]:i.zMax;if(m){for(e.counter.lut++,I=c.getUint8(o),V=u,o++,p=Math.ceil((I-1)*u/8),k=Math.ceil(p/4),M=new ArrayBuffer(k*4),y=new Uint8Array(M),e.ptr+=o,y.set(new Uint8Array(n,e.ptr,p)),v=new Uint32Array(M),e.ptr+=p,T=0;I-1>>>T;)T++;p=Math.ceil(g*T/8),k=Math.ceil(p/4),M=new ArrayBuffer(k*4),y=new Uint8Array(M),y.set(new Uint8Array(n,e.ptr,p)),U=new Uint32Array(M),e.ptr+=p,l>=3?w=E.unstuffLUT2(v,u,I-1,a,d,x):w=E.unstuffLUT(v,u,I-1,a,d,x),l>=3?E.unstuff2(U,r,T,g,w):E.unstuff(U,r,T,g,w)}else e.counter.bitstuffer++,T=u,e.ptr+=o,T>0&&(p=Math.ceil(g*T/8),k=Math.ceil(p/4),M=new ArrayBuffer(k*4),y=new Uint8Array(M),y.set(new Uint8Array(n,e.ptr,p)),U=new Uint32Array(M),e.ptr+=p,l>=3?a==null?E.originalUnstuff2(U,r,T,g):E.unstuff2(U,r,T,g,!1,a,d,x):a==null?E.originalUnstuff(U,r,T,g):E.unstuff(U,r,T,g,!1,a,d,x))}},readTiles:function(n,e,r){var a=e.headerInfo,t=a.width,i=a.height,l=a.microBlockSize,o=a.imageType,c=A.getDataTypeSize(o),h=Math.ceil(t/l),f=Math.ceil(i/l);e.pixels.numBlocksY=f,e.pixels.numBlocksX=h,e.pixels.ptr=0;var s=0,m=0,u=0,g=0,d=0,U=0,M=0,y=0,p=0,k=0,w=0,v=0,I=0,V=0,T=0,x=0,B,b,L,Y,C,R,q=new r(l*l),Ce=i%l||l,Oe=t%l||l,fe,ge,ke=a.numDims,le,J=e.pixels.resultMask,W=e.pixels.resultPixels;for(u=0;u<f;u++)for(d=u!==f-1?l:Ce,g=0;g<h;g++)for(U=g!==h-1?l:Oe,w=u*t*l+g*l,v=t-U,le=0;le<ke;le++){if(ke>1&&(W=new r(e.pixels.resultPixels.buffer,t*i*le*c,t*i)),M=n.byteLength-e.ptr,B=new DataView(n,e.ptr,Math.min(10,M)),b={},x=0,y=B.getUint8(0),x++,p=y>>6&255,k=y>>2&15,k!==(g*l>>3&15))throw"integrity issue";if(R=y&3,R>3)throw e.ptr+=x,"Invalid block encoding ("+R+")";if(R===2){e.counter.constant++,e.ptr+=x;continue}else if(R===0){if(e.counter.uncompressed++,e.ptr+=x,I=d*U*c,V=n.byteLength-e.ptr,I=I<V?I:V,L=new ArrayBuffer(I%c===0?I:I+c-I%c),Y=new Uint8Array(L),Y.set(new Uint8Array(n,e.ptr,I)),C=new r(L),T=0,J)for(s=0;s<d;s++){for(m=0;m<U;m++)J[w]&&(W[w]=C[T++]),w++;w+=v}else for(s=0;s<d;s++){for(m=0;m<U;m++)W[w++]=C[T++];w+=v}e.ptr+=T*c}else if(fe=A.getDataTypeUsed(o,p),ge=A.getOnePixel(b,x,fe,B),x+=A.getDataTypeSize(fe),R===3)if(e.ptr+=x,e.counter.constantoffset++,J)for(s=0;s<d;s++){for(m=0;m<U;m++)J[w]&&(W[w]=ge),w++;w+=v}else for(s=0;s<d;s++){for(m=0;m<U;m++)W[w++]=ge;w+=v}else if(e.ptr+=x,A.decodeBits(n,e,q,ge,le),x=0,J)for(s=0;s<d;s++){for(m=0;m<U;m++)J[w]&&(W[w]=q[x++]),w++;w+=v}else for(s=0;s<d;s++){for(m=0;m<U;m++)W[w++]=q[x++];w+=v}}},formatFileInfo:function(n){return{fileIdentifierString:n.headerInfo.fileIdentifierString,fileVersion:n.headerInfo.fileVersion,imageType:n.headerInfo.imageType,height:n.headerInfo.height,width:n.headerInfo.width,numValidPixel:n.headerInfo.numValidPixel,microBlockSize:n.headerInfo.microBlockSize,blobSize:n.headerInfo.blobSize,maxZError:n.headerInfo.maxZError,pixelType:A.getPixelType(n.headerInfo.imageType),eofOffset:n.eofOffset,mask:n.mask?{numBytes:n.mask.numBytes}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,maxValue:n.headerInfo.zMax,minValue:n.headerInfo.zMin,noDataValue:n.noDataValue}}},constructConstantSurface:function(n){var e=n.headerInfo.zMax,r=n.headerInfo.numDims,a=n.headerInfo.height*n.headerInfo.width,t=a*r,i=0,l=0,o=0,c=n.pixels.resultMask;if(c)if(r>1)for(i=0;i<r;i++)for(o=i*a,l=0;l<a;l++)c[l]&&(n.pixels.resultPixels[o+l]=e);else for(l=0;l<a;l++)c[l]&&(n.pixels.resultPixels[l]=e);else if(n.pixels.resultPixels.fill)n.pixels.resultPixels.fill(e);else for(l=0;l<t;l++)n.pixels.resultPixels[l]=e},getDataTypeArray:function(n){var e;switch(n){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(n){var e;switch(n){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(n,e){if(e==null)return!1;var r;switch(n){case 0:r=e>=-128&&e<=127;break;case 1:r=e>=0&&e<=255;break;case 2:r=e>=-32768&&e<=32767;break;case 3:r=e>=0&&e<=65536;break;case 4:r=e>=-2147483648&&e<=2147483647;break;case 5:r=e>=0&&e<=4294967296;break;case 6:r=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:r=e>=5e-324&&e<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(n){var e=0;switch(n){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=n}return e},getDataTypeUsed:function(n,e){var r=n;switch(n){case 2:case 4:r=n-e;break;case 3:case 5:r=n-2*e;break;case 6:e===0?r=n:e===1?r=2:r=1;break;case 7:e===0?r=n:r=n-2*e+1;break;default:r=n;break}return r},getOnePixel:function(n,e,r,a){var t=0;switch(r){case 0:t=a.getInt8(e);break;case 1:t=a.getUint8(e);break;case 2:t=a.getInt16(e,!0);break;case 3:t=a.getUint16(e,!0);break;case 4:t=a.getInt32(e,!0);break;case 5:t=a.getUInt32(e,!0);break;case 6:t=a.getFloat32(e,!0);break;case 7:t=a.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return t}},H=function(n,e,r){this.val=n,this.left=e,this.right=r},Q={decode:function(n,e){e=e||{};var r=e.noDataValue,a=0,t={};if(t.ptr=e.inputOffset||0,t.pixels={},!!A.readHeaderInfo(n,t)){var i=t.headerInfo,l=i.fileVersion,o=A.getDataTypeArray(i.imageType);A.readMask(n,t),i.numValidPixel!==i.width*i.height&&!t.pixels.resultMask&&(t.pixels.resultMask=e.maskData);var c=i.width*i.height;if(t.pixels.resultPixels=new o(c*i.numDims),t.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},i.numValidPixel!==0)if(i.zMax===i.zMin)A.constructConstantSurface(t);else if(l>=4&&A.checkMinMaxRanges(n,t))A.constructConstantSurface(t);else{var h=new DataView(n,t.ptr,2),f=h.getUint8(0);if(t.ptr++,f)A.readDataOneSweep(n,t,o);else if(l>1&&i.imageType<=1&&Math.abs(i.maxZError-.5)<1e-5){var s=h.getUint8(1);if(t.ptr++,t.encodeMode=s,s>2||l<4&&s>1)throw"Invalid Huffman flag "+s;s?A.readHuffman(n,t,o):A.readTiles(n,t,o)}else A.readTiles(n,t,o)}t.eofOffset=t.ptr;var m;e.inputOffset?(m=t.headerInfo.blobSize+e.inputOffset-t.ptr,Math.abs(m)>=1&&(t.eofOffset=e.inputOffset+t.headerInfo.blobSize)):(m=t.headerInfo.blobSize-t.ptr,Math.abs(m)>=1&&(t.eofOffset=t.headerInfo.blobSize));var u={width:i.width,height:i.height,pixelData:t.pixels.resultPixels,minValue:i.zMin,maxValue:i.zMax,validPixelCount:i.numValidPixel,dimCount:i.numDims,dimStats:{minValues:i.minValues,maxValues:i.maxValues},maskData:t.pixels.resultMask};if(t.pixels.resultMask&&A.isValidPixelValue(i.imageType,r)){var g=t.pixels.resultMask;for(a=0;a<c;a++)g[a]||(u.pixelData[a]=r);u.noDataValue=r}return t.noDataValue=r,e.returnFileInfo&&(u.fileInfo=A.formatFileInfo(t)),u}},getBandCount:function(n){var e=0,r=0,a={};for(a.ptr=0,a.pixels={};r<n.byteLength-58;)A.readHeaderInfo(n,a),r+=a.headerInfo.blobSize,e++,a.ptr=r;return e}};return Q}(),O=function(){var E=new ArrayBuffer(4),A=new Uint8Array(E),H=new Uint32Array(E);return H[0]=1,A[0]===1}(),ne={decode:function(E,A){if(!O)throw"Big endian system is not supported.";A=A||{};var H=A.inputOffset||0,Q=new Uint8Array(E,H,10),n=String.fromCharCode.apply(null,Q),e,r;if(n.trim()==="CntZImage")e=S,r=1;else if(n.substring(0,5)==="Lerc2")e=he,r=2;else throw"Unexpected file identifier string: "+n;for(var a=0,t=E.byteLength-10,i,l=[],o,c,h={width:0,height:0,pixels:[],pixelType:A.pixelType,mask:null,statistics:[]};H<t;){var f=e.decode(E,{inputOffset:H,encodedMaskData:i,maskData:c,returnMask:a===0,returnEncodedMask:a===0,returnFileInfo:!0,pixelType:A.pixelType||null,noDataValue:A.noDataValue||null});H=f.fileInfo.eofOffset,a===0&&(i=f.encodedMaskData,c=f.maskData,h.width=f.width,h.height=f.height,h.dimCount=f.dimCount||1,h.pixelType=f.pixelType||f.fileInfo.pixelType,h.mask=f.maskData),r>1&&f.fileInfo.mask&&f.fileInfo.mask.numBytes>0&&l.push(f.maskData),a++,h.pixels.push(f.pixelData),h.statistics.push({minValue:f.minValue,maxValue:f.maxValue,noDataValue:f.noDataValue,dimStats:f.dimStats})}var s,m,u;if(r>1&&l.length>1){for(u=h.width*h.height,h.bandMasks=l,c=new Uint8Array(u),c.set(l[0]),s=1;s<l.length;s++)for(o=l[s],m=0;m<u;m++)c[m]=c[m]&o[m];h.maskData=c}return h}};typeof define=="function"&&define.amd?define([],function(){return ne}):typeof be<"u"&&be.exports?be.exports=ne:this.Lerc=ne})()});var Er={NONE:0,LERC:1},vr=Object.freeze(Er);var ee={};ee.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var ir=new N,Br=new ce,Lr=new N,Nr=new N;ee.computeVertices=function(S){if(!$(S)||!$(S.heightmap))throw new ye("options.heightmap is required.");if(!$(S.width)||!$(S.height))throw new ye("options.width and options.height are required.");if(!$(S.nativeRectangle))throw new ye("options.nativeRectangle is required.");if(!$(S.skirtHeight))throw new ye("options.skirtHeight is required.");let he=Math.cos,O=Math.sin,ne=Math.sqrt,E=Math.atan,A=Math.exp,H=Te.PI_OVER_TWO,Q=Te.toRadians,n=S.heightmap,e=S.width,r=S.height,a=S.skirtHeight,t=a>0,i=Z(S.octEncodedNormals,void 0),l=$(S.octEncodedNormals),o=Z(S.aspectArrow,!1),c=Z(S.repeat,new Be(1,1)),h=Z(S.isGeographic,!0),f=Z(S.ellipsoid,Le.default),s=1/f.maximumRadius,m=me.clone(S.nativeRectangle),u=me.clone(S.rectangle),g,d,U,M;$(u)?(g=u.west,d=u.south,U=u.east,M=u.north):h?(g=Q(m.west),d=Q(m.south),U=Q(m.east),M=Q(m.north)):(g=m.west*s,d=H-2*E(A(-m.south*s)),U=m.east*s,M=H-2*E(A(-m.north*s)));let y=S.relativeToCenter,p=$(y);y=p?y:N.ZERO;let k=Z(S.includeWebMercatorT,!1),w=Z(S.exaggeration,1),v=Z(S.exaggerationRelativeHeight,0),V=w!==1,T=Z(S.structure,ee.DEFAULT_STRUCTURE),x=Z(T.heightScale,ee.DEFAULT_STRUCTURE.heightScale),B=Z(T.heightOffset,ee.DEFAULT_STRUCTURE.heightOffset),b=Z(T.elementsPerHeight,ee.DEFAULT_STRUCTURE.elementsPerHeight),L=Z(T.stride,ee.DEFAULT_STRUCTURE.stride),Y=Z(T.elementMultiplier,ee.DEFAULT_STRUCTURE.elementMultiplier),C=Z(T.isBigEndian,ee.DEFAULT_STRUCTURE.isBigEndian),R=me.computeWidth(m),q=me.computeHeight(m),Ce=R/(e-1),Oe=q/(r-1);h||(R*=s,q*=s);let fe=f.radiiSquared,ge=fe.x,ke=fe.y,le=fe.z,J=65536,W=-65536,tr=rr.eastNorthUpToFixedFrame(y,f),Ir=ce.inverseTransformation(tr,Br),Re,nr;k&&(Re=Fe.geodeticLatitudeToMercatorAngle(d),nr=1/(Fe.geodeticLatitudeToMercatorAngle(M)-Re));let de=Lr;de.x=Number.POSITIVE_INFINITY,de.y=Number.POSITIVE_INFINITY,de.z=Number.POSITIVE_INFINITY;let ve=Nr;ve.x=Number.NEGATIVE_INFINITY,ve.y=Number.NEGATIVE_INFINITY,ve.z=Number.NEGATIVE_INFINITY;let He=Number.POSITIVE_INFINITY,we=e*r,Ur=a>0?e*2+r*2:0,ae=we+Ur,ue=new Array(ae),_e=new Array(ae),Ie=new Array(ae),Ye=k?new Array(ae):[],ze=V?new Array(ae):[],Xe=0,Ze=r,je=0,qe=e;t&&(--Xe,++Ze,--je,++qe);let Me=1e-5;for(let D=Xe;D<Ze;++D){let _=D;_<0&&(_=0),_>=r&&(_=r-1);let F=m.north-Oe*_;h?F=Q(F):F=H-2*E(A(-F*s));let X=(F-d)/(M-d);X=Te.clamp(X,0,1);let P=D===Xe,j=D===Ze-1;a>0&&(P?F+=Me*q:j&&(F-=Me*q));let De=he(F),oe=O(F),Ue=le*oe,Ee;k&&(Ee=(Fe.geodeticLatitudeToMercatorAngle(F)-Re)*nr);for(let re=je;re<qe;++re){let G=re;G<0&&(G=0),G>=e&&(G=e-1);let pe=_*(e*L)+G*L,z;if(b===1)z=n[pe];else{z=0;let K;if(C)for(K=0;K<b;++K)z=z*Y+n[pe+K];else for(K=b-1;K>=0;--K)z=z*Y+n[pe+K]}z=z*x+B,W=Math.max(W,z),J=Math.min(J,z);let ie=m.west+Ce*G;h?ie=Q(ie):ie=ie*s;let Qe=(ie-g)/(U-g);Qe=Te.clamp(Qe,0,1);let te=_*e+G;if(a>0){let K=re===je,Pe=re===qe-1,Sr=P||j||K||Pe;if((P||j)&&(K||Pe))continue;Sr&&(z-=a,K?(te=we+(r-_-1),ie-=Me*R):j?te=we+r+(e-G-1):Pe?(te=we+r+e+_,ie+=Me*R):P&&(te=we+r+e+r+G))}let Je=De*he(ie),Ke=De*O(ie),or=ge*Je,fr=ke*Ke,$e=1/ne(or*Je+fr*Ke+Ue*oe),kr=or*$e,Mr=fr*$e,Vr=Ue*$e,xe=new N;xe.x=kr+Je*z,xe.y=Mr+Ke*z,xe.z=Vr+oe*z,ce.multiplyByPoint(Ir,xe,ir),N.minimumByComponent(ir,de,de),N.maximumByComponent(ir,ve,ve),He=Math.min(He,z),ue[te]=xe,Ie[te]=new Be(Qe,X),_e[te]=z,k&&(Ye[te]=Ee),V&&(ze[te]=f.geodeticSurfaceNormal(xe))}}let yr=lr.fromPoints(ue),ar;$(u)&&(ar=hr.fromRectangle(u,J,W,f));let sr;p&&(sr=new gr(f).computeHorizonCullingPointPossiblyUnderEllipsoid(y,ue,J));let Tr=new cr(de,ve,y),Ve=new dr(y,Tr,He,W,tr,l,k,V,w,v),We=new Float32Array(ae*Ve.stride),Se=0,Ae=[];for(let D=0;D<c.x*c.y;D++){let _=new N;Ae.push(_)}let se=new Be;for(let D=0;D<ae;++D)if(l){if(D<we){let _=D*2;if(se.x=i[_],se.y=i[_+1],o){let F=Ie[D].y,X=Ie[D].x;X=Math.floor(X*c.x),F=Math.floor(F*c.y);let P=new N;Ne.octDecode(se.x,se.y,P);let j=parseInt(F*c.x+X);j<c.x*c.y&&N.add(P,Ae[j],Ae[j])}if(w!==1){let F=Ne.octDecode(se.x,se.y,new N),X=rr.eastNorthUpToFixedFrame(ue[D],f,scratchFromENU),P=ce.inverseTransformation(X,scratchToENU);ce.multiplyByPointAsVector(P,F,F),F.z*=w,N.normalize(F,F),ce.multiplyByPointAsVector(X,F,F),N.normalize(F,F),Ne.octEncode(F,se)}}Se=Ve.encode(We,Se,ue[D],Ie[D],_e[D],se,Ye[D],ze[D])}else Se=Ve.encode(We,Se,ue[D],Ie[D],_e[D],void 0,Ye[D],ze[D]);let Ge=[];if(l&&o)for(let D=0;D<c.y;D++)for(let _=0;_<c.x;_++){let F=parseInt(D*c.x+_),X=Ae[F];if(N.magnitude(X)<1e-10){Ge.push(0);continue}N.normalize(X,X);let j=new N,De=parseInt(ae/2),oe=new mr(ue[De]);N.cross(oe.xAxis,oe.yAxis,j),N.normalize(j,j);let Ue=new N,Ee=N.dot(X,j);N.multiplyByScalar(j,Ee,Ue);let re=new N;N.subtract(X,Ue,re);let G=N.angleBetween(re,oe.xAxis),pe=new N;N.cross(oe.xAxis,re,pe),N.dot(pe,j)<0&&(G=2*Math.PI-G),Ge.push(G)}return{vertices:We,maximumHeight:W,minimumHeight:J,encoding:Ve,boundingSphere3D:yr,orientedBoundingBox:ar,occludeePointInScaledSpace:sr,aspect:Ge,repeat:c}};var wr=ee;var xr=Dr(pr(),1);function Fr(S,he){if(S.encoding===vr.LERC){let E;try{E=xr.default.decode(S.heightmap)}catch(H){throw new er(H)}if(E.statistics[0].minValue===Number.MAX_VALUE)throw new er("Invalid tile data");S.heightmap=E.pixels[0],S.width=E.width,S.height=E.height}S.ellipsoid=Le.clone(S.ellipsoid),S.rectangle=me.clone(S.rectangle);let O=wr.computeVertices(S),ne=O.vertices;return he.push(ne.buffer),{vertices:ne.buffer,numberOfAttributes:O.encoding.stride,minimumHeight:O.minimumHeight,maximumHeight:O.maximumHeight,gridWidth:S.width,gridHeight:S.height,boundingSphere3D:O.boundingSphere3D,orientedBoundingBox:O.orientedBoundingBox,occludeePointInScaledSpace:O.occludeePointInScaledSpace,encoding:O.encoding,westIndicesSouthToNorth:O.westIndicesSouthToNorth,southIndicesEastToWest:O.southIndicesEastToWest,eastIndicesNorthToSouth:O.eastIndicesNorthToSouth,northIndicesWestToEast:O.northIndicesWestToEast,aspect:O.aspect,repeat:O.repeat}}var ui=ur(Fr);export{ui as default};
