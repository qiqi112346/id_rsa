!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rasterTileLayer=e()}(this,function(){"use strict";Object.freeze=function(t){return t};var t=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();var e=/\{ *([\w_-]+) *\}/g;var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=3.141592653589793,o=6378245,a=.006693421622965943,n=3e3*r/180;function s(t,e,i){var o=r/180*e,a=Math.pow(2,i);return[parseInt((t+180)/360*a),parseInt((1-Math.asinh(Math.tan(o))/r)/2*a)]}function h(t,e){if(i(t)){var r=t[0];e=t[1],t=r}if(t instanceof Object){r=t.lng;e=t.lat,t=r}var o,a,s,h,l,u,p=(o=t-.0065,a=e-.006,s=Math.sqrt(o*o+a*a)-2e-5*Math.sin(a*n),h=Math.atan2(a,o)-3e-6*Math.cos(o*n),l=s*Math.cos(h),u=s*Math.sin(h),{lng:l,lat:u});return c(p.lng,p.lat)}function l(t,e){if(i(t)){var r=t[0];e=t[1],t=r}if(t instanceof Object){r=t.lng;e=t.lat,t=r}var o,a,s,h,l,c,p=u(t,e);return o=p.lng,a=p.lat,s=Math.sqrt(o*o+a*a)+2e-5*Math.sin(a*n),h=Math.atan2(a,o)+3e-6*Math.cos(o*n),l=s*Math.cos(h)+.0065,c=s*Math.sin(h)+.006,{lng:l,lat:c}}function u(t,e){if(i(t)){var n=t[0];e=t[1],t=n}if(t instanceof Object){n=t.lng;e=t.lat,t=n}var s=p(t-105,e-35),h=f(t-105,e-35),l=e/180*r,u=Math.sin(l);u=1-a*u*u;var c=Math.sqrt(u);return s=180*s/(o*(1-a)/(u*c)*r),{lng:t+(h=180*h/(o/c*Math.cos(l)*r)),lat:e+s}}function c(t,e){if(i(t)){var n=t[0];e=t[1],t=n}if(t instanceof Object){n=t.lng;e=t.lat,t=n}var s=function(t,e){var i=p(t-105,e-35),n=f(t-105,e-35),s=e/180*r,h=Math.sin(s);h=1-a*h*h;var l=Math.sqrt(h);return i=180*i/(o*(1-a)/(h*l)*r),n=180*n/(o/l*Math.cos(s)*r),{lng:t+n,lat:e+i}}(t,e);return{lng:2*t-s.lng,lat:2*e-s.lat}}function p(t,e){var i=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return i+=2*(20*Math.sin(6*t*r)+20*Math.sin(2*t*r))/3,i+=2*(20*Math.sin(e*r)+40*Math.sin(e/3*r))/3,i+=2*(160*Math.sin(e/12*r)+320*Math.sin(e*r/30))/3}function f(t,e){var i=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return i+=2*(20*Math.sin(6*t*r)+20*Math.sin(2*t*r))/3,i+=2*(20*Math.sin(t*r)+40*Math.sin(t/3*r))/3,i+=2*(150*Math.sin(t/12*r)+300*Math.sin(t/30*r))/3}function m(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function d(t){return"string"==typeof t}var g=void 0,_=null;function v(t,e){isNaN(t)&&(t=Ib(t),t=isNaN(t)?0:t),d(t)&&(t=parseFloat(t)),isNaN(e)&&(e=Ib(e),e=isNaN(e)?0:e),d(e)&&(e=parseFloat(e)),this.lng=t,this.lat=e}function x(t,e){this.x=t||0,this.y=e||0,this.x=this.x,this.y=this.y}function M(){}function b(){}v.TL=function(t){return t&&180>=t.lng&&-180<=t.lng&&74>=t.lat&&-74<=t.lat},v.prototype.lb=function(t){return t&&this.lat==t.lat&&this.lng==t.lng},x.prototype.lb=function(t){return t&&t.x==this.x&&t.y==this.y},M.prototype.nh=function(){aa("lngLatToPoint方法未实现")},M.prototype.wi=function(){aa("pointToLngLat方法未实现")},b.prototype=new M,m(b,{$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Z1:function(t,e){return t&&e&&(t=this.Fb(t))?(i=this.Tk(t.lng),r=this.Tk(t.lat),(e=this.Fb(e))?this.Pe(i,this.Tk(e.lng),r,this.Tk(e.lat)):0):0;var i,r},Vo:function(t,e){return t&&e?(t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),e.lng=this.JD(e.lng,-180,180),e.lat=this.ND(e.lat,-74,74),this.Pe(this.Tk(t.lng),this.Tk(e.lng),this.Tk(t.lat),this.Tk(e.lat))):0},Fb:function(t){if(t===_||t===g)return new v(0,0);var e,i;e=new v(Math.abs(t.lng),Math.abs(t.lat));for(var r=0;r<this.lG.length;r++)if(e.lat>=this.lG[r]){i=this.fP[r];break}return new v((t=this.gK(t,i)).lng.toFixed(6),t.lat.toFixed(6))},Eb:function(t){if(t===_||t===g||180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return new v(0,0);var e,i;t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),e=new v(t.lng,t.lat);for(var r=0;r<this.Au.length;r++)if(e.lat>=this.Au[r]){i=this.iG[r];break}if(!i)for(r=0;r<this.Au.length;r++)if(e.lat<=-this.Au[r]){i=this.iG[r];break}return new v((t=this.gK(t,i)).lng.toFixed(2),t.lat.toFixed(2))},gK:function(t,e){if(t&&e){var i=e[0]+e[1]*Math.abs(t.lng),r=Math.abs(t.lat)/e[9];r=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return new v(i=i*(0>t.lng?-1:1),r=r*(0>t.lat?-1:1))}},Pe:function(t,e,i,r){return this.$O*Math.acos(Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(e-t))},Tk:function(t){return Math.PI*t/180},Z3:function(t){return 180*t/Math.PI},ND:function(t,e,i){return e!=_&&(t=Math.max(t,e)),i!=_&&(t=Math.min(t,i)),t},JD:function(t,e,i){for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),m(b.prototype,{Jm:function(t){return b.Eb(t)},nh:function(t){return new x((t=b.Eb(t)).lng,t.lat)},qh:function(t){return b.Fb(t)},wi:function(t){return t=new v(t.x,t.y),b.Fb(t)},fc:function(t,e,i,r,o){if(t)return t=this.Jm(t,o),e=this.Lc(e),new x(Math.round((t.lng-i.lng)/e+r.width/2),Math.round((i.lat-t.lat)/e+r.height/2))},zb:function(t,e,i,r,o){if(t)return e=this.Lc(e),this.qh(new v(i.lng+e*(t.x-r.width/2),i.lat-e*(t.y-r.height/2)),o)},Lc:function(t){return Math.pow(2,18-t)}});var y=b.prototype;!function(t,e){for(var i in e)t[i]=e[i]}(y,{lngLatToPoint:y.nh,pointToLngLat:y.wi});let T={Point:v,Pixel:x,MercatorProjection:b};class P{constructor(t,e){this.levelMax=t,this.levelMin=e,this.projection=new T.MercatorProjection}_getRetain(t){return Math.pow(2,t-18)}getResolution(t,e){return Math.pow(2,18-e)*Math.cos(t)}lnglatToPoint(t,e){let i=new T.Point(t,e),r=this.projection.lngLatToPoint(i);return{pointX:r.x,pointY:r.y}}pointToLnglat(t,e){let i=new T.Pixel(t,e),r=this.projection.pointToLngLat(i);return{lng:r.lng,lat:r.lat}}_lngToTileX(t,e){let i=this.lnglatToPoint(t,0);return Math.floor(i.pointX*this._getRetain(e)/256)}_latToTileY(t,e){let i=this.lnglatToPoint(0,t);return Math.floor(i.pointY*this._getRetain(e)/256)}lnglatToTile(t,e,i){return[this._lngToTileX(t,i),this._latToTileY(e,i)]}_lngToPixelX(t,e){let i=this._lngToTileX(t,e),r=this.lnglatToPoint(t,0);return Math.floor(r.pointX*this._getRetain(e)-256*i)}_latToPixelY(t,e){let i=this._latToTileY(t,e),r=this.lnglatToPoint(0,t);return Math.floor(r.pointY*this._getRetain(e)-256*i)}lnglatToPixel(t,e,i){return{pixelX:this._lngToPixelX(t,i),pixelY:this._latToPixelY(e,i)}}_pixelXToLng(t,e,i){let r=(256*e+t)/this._getRetain(i);return this.pointToLnglat(r,0).lng}_pixelYToLat(t,e,i){let r=(256*e+t)/this._getRetain(i);return this.pointToLnglat(0,r).lat}pixelToLnglat(t,e,i,r,o){let a=(256*i+t)/this._getRetain(o),n=(256*r+e)/this._getRetain(o),s=this.pointToLnglat(a,n);return[s.lng,s.lat]}}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t){"@babel/helpers - typeof";return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t){var e=function(t,e){if("object"!=z(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==z(e)?e:e+""}function S(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,j(r.key),r)}}function A(t,e,i){return e&&S(t.prototype,e),i&&S(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function L(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function R(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,o,a,n,s=[],h=!0,l=!1;try{if(a=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=a.call(i)).done)&&(s.push(r.value),s.length!==e);h=!0);}catch(t){l=!0,o=t}finally{try{if(!h&&null!=i.return&&(n=i.return(),Object(n)!==n))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return F(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?F(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D,N=1e-6,k="undefined"!=typeof Float32Array?Float32Array:Array;function O(t,e,i){var r=e[0],o=e[1],a=e[2],n=e[3];return t[0]=i[0]*r+i[4]*o+i[8]*a+i[12]*n,t[1]=i[1]*r+i[5]*o+i[9]*a+i[13]*n,t[2]=i[2]*r+i[6]*o+i[10]*a+i[14]*n,t[3]=i[3]*r+i[7]*o+i[11]*a+i[15]*n,t}function I(t,e){var i,r,o,a=O([],e,t);return i=a,r=a,o=1/a[3],i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[3]=r[3]*o,a}function U(t,e,i){var r=e[0],o=e[1],a=e[2],n=e[3],s=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],f=e[10],m=e[11],d=e[12],g=e[13],_=e[14],v=e[15],x=i[0],M=i[1],b=i[2],y=i[3];return t[0]=x*r+M*s+b*c+y*d,t[1]=x*o+M*h+b*p+y*g,t[2]=x*a+M*l+b*f+y*_,t[3]=x*n+M*u+b*m+y*v,x=i[4],M=i[5],b=i[6],y=i[7],t[4]=x*r+M*s+b*c+y*d,t[5]=x*o+M*h+b*p+y*g,t[6]=x*a+M*l+b*f+y*_,t[7]=x*n+M*u+b*m+y*v,x=i[8],M=i[9],b=i[10],y=i[11],t[8]=x*r+M*s+b*c+y*d,t[9]=x*o+M*h+b*p+y*g,t[10]=x*a+M*l+b*f+y*_,t[11]=x*n+M*u+b*m+y*v,x=i[12],M=i[13],b=i[14],y=i[15],t[12]=x*r+M*s+b*c+y*d,t[13]=x*o+M*h+b*p+y*g,t[14]=x*a+M*l+b*f+y*_,t[15]=x*n+M*u+b*m+y*v,t}function B(t,e,i){var r,o,a,n,s,h,l,u,c,p,f,m,d=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*d+e[4]*g+e[8]*_+e[12],t[13]=e[1]*d+e[5]*g+e[9]*_+e[13],t[14]=e[2]*d+e[6]*g+e[10]*_+e[14],t[15]=e[3]*d+e[7]*g+e[11]*_+e[15]):(r=e[0],o=e[1],a=e[2],n=e[3],s=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],f=e[10],m=e[11],t[0]=r,t[1]=o,t[2]=a,t[3]=n,t[4]=s,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=p,t[10]=f,t[11]=m,t[12]=r*d+s*g+c*_+e[12],t[13]=o*d+h*g+p*_+e[13],t[14]=a*d+l*g+f*_+e[14],t[15]=n*d+u*g+m*_+e[15]),t}function Y(t,e,i){var r=i[0],o=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),D=new k(4),k!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[3]=0);var G=function(t,e,i,r,o){var a,n=1/Math.tan(e/2);return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(a=1/(r-o),t[10]=(o+r)*a,t[14]=2*o*r*a):(t[10]=-1,t[14]=-2*r),t};function X(t,e){var i=t[0],r=t[1],o=t[2],a=t[3],n=t[4],s=t[5],h=t[6],l=t[7],u=t[8],c=t[9],p=t[10],f=t[11],m=t[12],d=t[13],g=t[14],_=t[15],v=e[0],x=e[1],M=e[2],b=e[3],y=e[4],T=e[5],P=e[6],w=e[7],z=e[8],j=e[9],S=e[10],A=e[11],L=e[12],E=e[13],C=e[14],F=e[15];return Math.abs(i-v)<=N*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-x)<=N*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-M)<=N*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-b)<=N*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(n-y)<=N*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-T)<=N*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(h-P)<=N*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(l-w)<=N*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(u-z)<=N*Math.max(1,Math.abs(u),Math.abs(z))&&Math.abs(c-j)<=N*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(p-S)<=N*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(f-A)<=N*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(m-L)<=N*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(d-E)<=N*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(g-C)<=N*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(_-F)<=N*Math.max(1,Math.abs(_),Math.abs(F))}function Z(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function q(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}!function(){var t,e=(t=new k(2),k!=Float32Array&&(t[0]=0,t[1]=0),t)}(),function(){var t,e=(t=new k(3),k!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t)}();var K=Math.PI,W=K/4,V=K/180,J=180/K,H=512,$=4003e4,Q=1.5;function tt(t){return Math.pow(2,t)}function et(t,e){var i=R(t,2),r=i[0],o=i[1];q(Number.isFinite(r)&&Number.isFinite(e)),q(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude");var a=o*V;return[(e*=H)*(r*V+K)/(2*K),e*(K-Math.log(Math.tan(W+.5*a)))/(2*K)]}function it(t,e){var i=R(t,2),r=i[0],o=i[1],a=r/(e*=H)*(2*K)-K,n=2*(Math.atan(Math.exp(K-o/e*(2*K)))-W);return[a*J,n*J]}function rt(t){var e,i,r,o,a,n,s,h,l,u,c,p,f,m=t.height,d=t.pitch,g=t.bearing,_=t.altitude,v=t.center,x=void 0===v?null:v,M=t.flipY,b=void 0!==M&&M,y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return B(y,y,[0,0,-_]),Y(y,y,[1,1,1/m]),e=y,i=y,r=-d*V,o=Math.sin(r),a=Math.cos(r),n=i[4],s=i[5],h=i[6],l=i[7],u=i[8],c=i[9],p=i[10],f=i[11],i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=n*a+u*o,e[5]=s*a+c*o,e[6]=h*a+p*o,e[7]=l*a+f*o,e[8]=u*a-n*o,e[9]=c*a-s*o,e[10]=p*a-h*o,e[11]=f*a-l*o,function(t,e,i){var r=Math.sin(i),o=Math.cos(i),a=e[0],n=e[1],s=e[2],h=e[3],l=e[4],u=e[5],c=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*o+l*r,t[1]=n*o+u*r,t[2]=s*o+c*r,t[3]=h*o+p*r,t[4]=l*o-a*r,t[5]=u*o-n*r,t[6]=c*o-s*r,t[7]=p*o-h*r}(y,y,g*V),b&&Y(y,y,[1,-1,1]),x&&B(y,y,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],x)),y}function ot(t){var e=t.width,i=t.height,r=t.pitch,o=function(t){var e=t.width,i=t.height,r=t.altitude,o=void 0===r?Q:r,a=t.pitch,n=void 0===a?0:a,s=t.nearZMultiplier,h=void 0===s?1:s,l=t.farZMultiplier,u=void 0===l?1:l,c=n*V,p=Math.atan(.5/o),f=Math.sin(p)*o/Math.sin(Math.PI/2-c-p),m=Math.cos(Math.PI/2-c)*f+o;return{fov:2*Math.atan(i/2/o),aspect:e/i,focalDistance:o,near:h,far:m*u}}({width:e,height:i,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),a=o.fov,n=o.aspect,s=o.near,h=o.far;return G([],a,n,s,h)}function at(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=R(t,3),o=r[0],a=r[1],n=r[2];if(q(Number.isFinite(o)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(n))return I(e,[o,a,n,1]);var s=I(e,[o,a,0,1]),h=I(e,[o,a,1,1]),l=s[2],u=h[2];return function(t,e,i,r){var o=e[0],a=e[1];return t[0]=o+r*(i[0]-o),t[1]=a+r*(i[1]-a),t}([],s,h,l===u?0:((i||0)-l)/(u-l))}var nt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],st=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width,r=e.height,o=e.viewMatrix,a=void 0===o?nt:o,n=e.projectionMatrix,s=void 0===n?nt:n;w(this,t),this.width=i||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];U(h,h,this.projectionMatrix),U(h,h,this.viewMatrix),this.viewProjectionMatrix=h;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Y(l,l,[this.width/2,-this.height/2,1]),B(l,l,[1,-1,0]),U(l,l,this.viewProjectionMatrix);var u,c,p,f,m,d,g,_,v,x,M,b,y,T,P,z,j,S,A,L,E,C,F,R,D,N,k,O,I,G,X,Z=(u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=(c=l)[0],f=c[1],m=c[2],d=c[3],g=c[4],_=c[5],v=c[6],x=c[7],M=c[8],b=c[9],y=c[10],T=c[11],P=c[12],z=c[13],j=c[14],S=c[15],(X=(A=p*_-f*g)*(G=y*S-T*j)-(L=p*v-m*g)*(I=b*S-T*z)+(E=p*x-d*g)*(O=b*j-y*z)+(C=f*v-m*_)*(k=M*S-T*P)-(F=f*x-d*_)*(N=M*j-y*P)+(R=m*x-d*v)*(D=M*z-b*P))?(X=1/X,u[0]=(_*G-v*I+x*O)*X,u[1]=(m*I-f*G-d*O)*X,u[2]=(z*R-j*F+S*C)*X,u[3]=(y*F-b*R-T*C)*X,u[4]=(v*k-g*G-x*N)*X,u[5]=(p*G-m*k+d*N)*X,u[6]=(j*E-P*R-S*L)*X,u[7]=(M*R-y*E+T*L)*X,u[8]=(g*I-_*k+x*D)*X,u[9]=(f*k-p*I-d*D)*X,u[10]=(P*F-z*E+S*A)*X,u[11]=(b*E-M*F-T*A)*X,u[12]=(_*N-g*O-v*D)*X,u[13]=(p*O-f*N+m*D)*X,u[14]=(z*L-P*C-j*A)*X,u[15]=(M*C-b*L+y*A)*X,u):null);if(!Z)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=Z,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return A(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&X(e.projectionMatrix,this.projectionMatrix)&&X(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===e||e,r=function(t,e){var i=R(t,3),r=i[0],o=i[1],a=i[2],n=void 0===a?0:a;return q(Number.isFinite(r)&&Number.isFinite(o)&&Number.isFinite(n)),I(e,[r,o,n,1])}(this.projectPosition(t),this.pixelProjectionMatrix),o=R(r,2),a=o[0],n=o[1],s=i?n:this.height-n;return 2===t.length?[a,s]:[a,s,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,r=void 0===i||i,o=e.targetZ,a=R(t,3),n=a[0],s=a[1],h=a[2],l=r?s:this.height-s,u=o&&o*this.pixelsPerMeter,c=at([n,l,h],this.pixelUnprojectionMatrix,u),p=R(this.unprojectPosition(c),3),f=p[0],m=p[1],d=p[2];return Number.isFinite(h)?[f,m,d]:Number.isFinite(o)?[f,m,o]:[f,m]}},{key:"projectPosition",value:function(t){var e=R(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=R(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}}]),t}();function ht(t){var e=t.width,i=t.height,r=t.bounds,o=t.minExtent,a=void 0===o?0:o,n=t.maxZoom,s=void 0===n?24:n,h=t.padding,l=void 0===h?0:h,u=t.offset,c=void 0===u?[0,0]:u,p=R(r,2),f=R(p[0],2),m=f[0],d=f[1],g=R(p[1],2),_=g[0],v=g[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else q(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var x=new lt({width:e,height:i,longitude:0,latitude:0,zoom:0}),M=x.project([m,v]),b=x.project([_,d]),y=[Math.max(Math.abs(b[0]-M[0]),a),Math.max(Math.abs(b[1]-M[1]),a)],T=[e-l.left-l.right-2*Math.abs(c[0]),i-l.top-l.bottom-2*Math.abs(c[1])];q(T[0]>0&&T[1]>0);var P=T[0]/y[0],w=T[1]/y[1],z=(l.right-l.left)/2/P,j=(l.bottom-l.top)/2/w,S=[(b[0]+M[0])/2+z,(b[1]+M[1])/2+j],A=x.unproject(S),L=x.zoom+Math.log2(Math.abs(Math.min(P,w)));return{longitude:A[0],latitude:A[1],zoom:Math.min(L,s)}}var lt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.width,o=i.height,a=i.latitude,n=void 0===a?0:a,s=i.longitude,h=void 0===s?0:s,l=i.zoom,u=void 0===l?0:l,c=i.pitch,p=void 0===c?0:c,f=i.bearing,m=void 0===f?0:f,d=i.altitude,g=void 0===d?1.5:d,_=i.nearZMultiplier,v=i.farZMultiplier;w(this,e),r=r||1,o=o||1;var x=tt(u);g=Math.max(.75,g);var M=et([h,n],x);M[2]=0;var b=ot({width:r,height:o,pitch:p,bearing:m,altitude:g,nearZMultiplier:_||1/o,farZMultiplier:v||1.01}),y=rt({height:o,center:M,pitch:p,bearing:m,altitude:g,flipY:!0});return(t=function(t,e){if(e&&("object"==z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return L(t)}(this,E(e).call(this,{width:r,height:o,viewMatrix:y,projectionMatrix:b}))).latitude=n,t.longitude=h,t.zoom=u,t.pitch=p,t.bearing=m,t.altitude=g,t.scale=x,t.center=M,t.pixelsPerMeter=function(t){var e=t.latitude,i=t.longitude,r=t.zoom,o=t.scale,a=t.highPrecision,n=void 0!==a&&a;o=void 0!==o?o:tt(r),q(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(o));var s={},h=H*o,l=Math.cos(e*V),u=h/360,c=u/l,p=h/$/l;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[u,-c,p],s.degreesPerPixel=[1/u,-1/c,1/p],n){var f=V*Math.tan(e*V)/l,m=u*f/2,d=h/$*f,g=d/c*p;s.pixelsPerDegree2=[0,-m,d],s.pixelsPerMeter2=[g,0,g]}return s}(L(L(t))).pixelsPerMeter[2],Object.freeze(L(L(t))),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&C(t,e)}(e,st),A(e,[{key:"projectFlat",value:function(t){return et(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return it(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e,i,r=t.lngLat,o=at(t.pos,this.pixelUnprojectionMatrix),a=Z([],et(r,this.scale),((e=[])[0]=-(i=o)[0],e[1]=-i[1],e));return it(Z([],this.center,a),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,o=this.height,a=ht(Object.assign({width:r,height:o,bounds:t},i));return new e({width:r,height:o,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}();const ut=Math.PI/180,ct=512,pt=4003e4;function ft(t){return Math.pow(2,t)}function mt(t){return[t[0]/360+.5,.25-t[1]/360,0,1]}class dt{constructor(e,i,r){this.id=e,this.type="custom",this.renderingMode="2d",this.url=i,this.options={subdomains:null,minZoom:3,maxZoom:18,tileType:"xyz"},function(e,i){for(var r in e.hasOwnProperty("options")||(e.options=e.options?t(e.options):{}),i)e.options[r]=i[r]||e.options[r];e.options}(this,r),this.program,this.showTiles=[],this.tileCache={},this.gridCache={},this.matrix,this.map,this.isLayerShow,this.transformBaidu=new P}onAdd(t,e){var i;this.map=t,this.isEPSG4326="EPSG:4326"===t.crs.getEpsgCode(),i=this.isEPSG4326?"uniform mat4 u_custom_matrix;uniform vec4 u_center_pos;attribute vec4 a_Pos_Piexl;attribute vec2 a_TextCoord_Piexl;varying vec2 v_TextCoord;vec2 translateRelativeToEye(vec2 high, vec2 low) {   vec2 highDiff = high - vec2(u_center_pos.x, u_center_pos.z);   vec2 lowDiff = low - vec2(u_center_pos.y, u_center_pos.w);   return highDiff + lowDiff;}void main() {   vec2 eye_offset = translateRelativeToEye(vec2(a_Pos_Piexl.x, a_Pos_Piexl.z), vec2(a_Pos_Piexl.y, a_Pos_Piexl.w));   gl_Position = u_custom_matrix * vec4(eye_offset, 0.0, 1.0);   v_TextCoord = a_TextCoord_Piexl;}":"uniform mat4 u_matrix;uniform mat4 u_custom_matrix;attribute vec2 a_pos;attribute vec2 a_TextCoord;varying vec2 v_TextCoord;const float TILE_SIZE = 512.0;const float PI = 3.1415926536;const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);uniform float u_project_scale;uniform bool u_is_offset;uniform vec3 u_pixels_per_degree;uniform vec3 u_pixels_per_degree2;uniform vec3 u_pixels_per_meter;uniform vec2 u_viewport_center;uniform vec4 u_viewport_center_projection;uniform vec2 u_viewport_size;float project_scale(float meters) {    return meters * u_pixels_per_meter.z;}vec3 project_scale(vec3 position) {    return position * u_pixels_per_meter;}vec2 project_mercator(vec2 lnglat) {    float x = lnglat.x;    return vec2(    radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))    );}vec4 project_offset(vec4 offset) {    float dy = offset.y;    dy = clamp(dy, -1., 1.);    vec3 pixels_per_unit = u_pixels_per_degree + u_pixels_per_degree2 * dy;    return vec4(offset.xyz * pixels_per_unit, offset.w);}vec4 project_position(vec4 position) {    if (u_is_offset) {        float X = position.x - u_viewport_center.x;        float Y = position.y - u_viewport_center.y;        return project_offset(vec4(X, Y, position.z, position.w));    }    else {        return vec4(        project_mercator(position.xy) * WORLD_SCALE * u_project_scale, project_scale(position.z), position.w        );    }}vec4 project_to_clipping_space(vec3 position) {    vec4 project_pos = project_position(vec4(position, 1.0));    return u_matrix * project_pos + u_viewport_center_projection;}void main() {   vec4 project_pos = project_position(vec4(a_pos, 0.0, 1.0));   gl_Position = u_matrix * project_pos + u_viewport_center_projection;   v_TextCoord = a_TextCoord;}";var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,i),e.compileShader(r);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,"precision mediump float;uniform sampler2D u_Sampler; varying vec2 v_TextCoord; void main() {   gl_FragColor = texture2D(u_Sampler, v_TextCoord);}"),e.compileShader(o),this.program=e.createProgram(),e.attachShader(this.program,r),e.attachShader(this.program,o),e.linkProgram(this.program),this.isEPSG4326?(this.a_Pos_Piexl=e.getAttribLocation(this.program,"a_Pos_Piexl"),this.a_TileZoomScale=e.getAttribLocation(this.program,"a_TileZoomScale"),this.a_TextCoord_Piexl=e.getAttribLocation(this.program,"a_TextCoord_Piexl")):(this.a_Pos=e.getAttribLocation(this.program,"a_pos"),this.a_TextCoord=e.getAttribLocation(this.program,"a_TextCoord")),this.isLayerShow=!0,t.on("move",()=>{this.isLayerShow&&this.update(e,t)}),this.update(e,t)}update(t,e){var i,r,o,a=e.getCenter(),n=e.getBounds();if("xyz"===this.options.tileType){i=parseInt(e.getZoom()+1.4);var h=u(n.getNorthWest()),c=u(n.getSouthEast());r=s(h.lng,h.lat,i),o=s(c.lng,c.lat,i)}else if("bd09"===this.options.tileType){i=parseInt(e.getZoom()+1.8);var p=l(n.getSouthWest()),f=l(n.getNorthEast());r=this.transformBaidu.lnglatToTile(p.lng,p.lat,i),o=this.transformBaidu.lnglatToTile(f.lng,f.lat,i)}for(var m=[],d=r[0];d<=o[0];d++)for(var g=r[1];g<=o[1];g++){var _={x:d,y:g,z:i};m.push(_),this.addGridCache(_,0,0),d===o[0]&&this.addGridCache(_,1,0),g===o[1]&&this.addGridCache(_,0,1),d===o[0]&&g===o[1]&&this.addGridCache(_,1,1)}if("xyz"===this.options.tileType)var v=s(a.lng,a.lat,i);else"bd09"===this.options.tileType&&(v=this.transformBaidu.lnglatToTile(a.lng,a.lat,i));for(var _ of(m.sort((t,e)=>this.tileDistance(t,v)-this.tileDistance(e,v)),this.showTiles=[],m))if(this.tileCache[this.createTileKey(_)])this.showTiles.push(this.tileCache[this.createTileKey(_)]);else{var x=this.createTile(t,_);this.showTiles.push(x),this.tileCache[this.createTileKey(_)]=x}}addGridCache(t,e,i){var o=this.createTileKey(t.x+e,t.y+i,t.z);this.gridCache[o]||("xyz"===this.options.tileType?this.gridCache[o]=c(function(t,e,i){let o=Math.pow(2,i);return[t/o*360-180,180*Math.atan(Math.sinh(r*(1-2*e/o)))/r]}(t.x+e,t.y+i,t.z)):"bd09"===this.options.tileType&&(this.gridCache[o]=h(this.transformBaidu.pixelToLnglat(0,0,t.x+e,t.y+i,t.z))))}tileDistance(t,e){return Math.sqrt(Math.pow(t.x-e[0],2)+Math.pow(t.y-e[1],2))}createTileKey(t,e,i){return t instanceof Object?t.z+"/"+t.x+"/"+t.y:i+"/"+t+"/"+e}createTile(t,i){var r,o,a,n,s,h,l=(r=this.url,o={s:this.options.subdomains[Math.abs(i.x+i.y)%this.options.subdomains.length],x:i.x,y:i.y,z:i.z},r.replace(e,function(t,e){var i=o[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(o)),i})),u={xyz:i};"xyz"===this.options.tileType?(a=this.gridCache[this.createTileKey(i)],n=this.gridCache[this.createTileKey(i.x+1,i.y,i.z)],s=this.gridCache[this.createTileKey(i.x,i.y+1,i.z)],h=this.gridCache[this.createTileKey(i.x+1,i.y+1,i.z)]):"bd09"===this.options.tileType&&(a=this.gridCache[this.createTileKey(i.x,i.y+1,i.z)],n=this.gridCache[this.createTileKey(i.x+1,i.y+1,i.z)],s=this.gridCache[this.createTileKey(i)],h=this.gridCache[this.createTileKey(i.x+1,i.y,i.z)]);var c=new Float32Array([a.lng,a.lat,0,1,s.lng,s.lat,0,0,n.lng,n.lat,1,1,h.lng,h.lat,1,0]),p=c.BYTES_PER_ELEMENT,f=t.createBuffer();if(t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,c,t.STATIC_DRAW),u.buffer=f,u.PosParam={size:2,stride:4*p,offset:0},u.TextCoordParam={size:2,stride:4*p,offset:2*p},this.isEPSG4326){const e=mt([a.lng,a.lat]),i=mt([n.lng,n.lat]),r=mt([s.lng,s.lat]),o=mt([h.lng,h.lat]),l=new Float32Array([Math.fround(e[0]),e[0]-Math.fround(e[0]),Math.fround(e[1]),e[1]-Math.fround(e[1]),0,1,Math.fround(r[0]),r[0]-Math.fround(r[0]),Math.fround(r[1]),r[1]-Math.fround(r[1]),0,0,Math.fround(i[0]),i[0]-Math.fround(i[0]),Math.fround(i[1]),i[1]-Math.fround(i[1]),1,1,Math.fround(o[0]),o[0]-Math.fround(o[0]),Math.fround(o[1]),o[1]-Math.fround(o[1]),1,0]);p=l.BYTES_PER_ELEMENT;var m=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),u.bufferPixel=m,u.PosPiexelsParam={size:4,stride:6*p,offset:0},u.TextPiexelsCoordParam={size:2,stride:6*p,offset:4*p}}var d=new Image;return d.onload=(()=>{u.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,u.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,d),u.isLoad=!0,this.map.triggerRepaint()}),d.crossOrigin=!0,d.src=l,u}render(t,e){if(!(this.map.getZoom()<this.options.minZoom||this.map.getZoom()>this.options.maxZoom))for(var i of(this.matrix=e,t.useProgram(this.program),this.showTiles))if(i.isLoad){t.bindTexture(t.TEXTURE_2D,i.texture),t.activeTexture(t.TEXTURE0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT);var r=t.getUniformLocation(this.program,"u_Sampler");t.uniform1i(r,0),this.isEPSG4326?(t.bindBuffer(t.ARRAY_BUFFER,i.bufferPixel),t.vertexAttribPointer(this.a_Pos_Piexl,i.PosPiexelsParam.size,t.FLOAT,!1,i.PosPiexelsParam.stride,i.PosPiexelsParam.offset),t.enableVertexAttribArray(this.a_Pos_Piexl),t.vertexAttribPointer(this.a_TextCoord_Piexl,i.TextPiexelsCoordParam.size,t.FLOAT,!1,i.TextPiexelsCoordParam.stride,i.TextPiexelsCoordParam.offset),t.enableVertexAttribArray(this.a_TextCoord_Piexl)):(t.bindBuffer(t.ARRAY_BUFFER,i.buffer),t.vertexAttribPointer(this.a_Pos,i.PosParam.size,t.FLOAT,!1,i.PosParam.stride,i.PosParam.offset),t.enableVertexAttribArray(this.a_Pos),t.vertexAttribPointer(this.a_TextCoord,i.TextCoordParam.size,t.FLOAT,!1,i.TextCoordParam.stride,i.TextCoordParam.offset),t.enableVertexAttribArray(this.a_TextCoord)),this.setVertex(t,e),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}setVertex(t,e){const i=this.map.getZoom(),r=this.map.getBearing(),o=this.map.getPitch(),a=this.map.getCenter(),n=new lt({width:t.drawingBufferWidth,height:t.drawingBufferHeight,longitude:a.lng,latitude:a.lat,zoom:i,pitch:o,bearing:r}),{viewProjectionMatrix:s,projectionMatrix:h,viewMatrix:l,viewMatrixUncentered:u}=n,c=this.map.painter;this.map.transform,c.options.moving;const p=mt([a.lng,a.lat]),f=e.slice();f[12]+=f[0]*p[0]+f[4]*p[1],f[13]+=f[1]*p[0]+f[5]*p[1],f[14]+=f[2]*p[0]+f[6]*p[1],f[15]+=f[3]*p[0]+f[7]*p[1];let m={u_matrix:s,u_point_size:this.pointSize,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_project_scale:ft(i),u_viewport_center_projection:[0,0,0,0],u_custom_matrix:f,u_center_pos:new Float32Array([Math.fround(p[0]),p[0]-Math.fround(p[0]),Math.fround(p[1]),p[1]-Math.fround(p[1])])};if(i>12)if(this.isEPSG4326);else{const{pixelsPerDegree:t,pixelsPerDegree2:e}=function(t){let{latitude:e=0,zoom:i=1,scale:r,highPrecision:o=!1}=t;r=void 0!==r?r:ft(i);const a={},n=ct*r*window.devicePixelRatio,s=Math.cos(e*ut),h=n/360,l=h/s,u=n/pt/s;if(a.pixelsPerMeter=[u,-u,u],a.metersPerPixel=[1/u,-1/u,1/u],a.pixelsPerDegree=[h,-l,u],a.degreesPerPixel=[1/h,-1/l,1/u],o){const t=ut*Math.tan(e*ut)/s,i=h*t/2,r=n/pt*t,o=r/l*u;a.pixelsPerDegree2=[0,-i,r],a.pixelsPerMeter2=[o,0,o]}return a}({longitude:a.lng,latitude:a.lat,zoom:i,highPrecision:!0}),r=n.projectFlat([Math.fround(a.lng),Math.fround(a.lat)],Math.pow(2,i)),o=O([],[r[0],r[1],0,1],s);let c=U([],h,u||l);c=U([],c,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),m.u_matrix=c,m.u_is_offset=!0,m.u_viewport_center=[Math.fround(a.lng),Math.fround(a.lat)],m.u_viewport_center_projection=o,m.u_pixels_per_degree=t&&t.map(t=>Math.fround(t)),m.u_pixels_per_degree2=e&&e.map(t=>Math.fround(t))}t.uniformMatrix4fv(t.getUniformLocation(this.program,"u_custom_matrix"),!1,m.u_custom_matrix),t.uniform4fv(t.getUniformLocation(this.program,"u_center_pos"),m.u_center_pos),t.uniformMatrix4fv(t.getUniformLocation(this.program,"u_matrix"),!1,m.u_matrix),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_meter"),m.u_pixels_per_meter),t.uniform1i(t.getUniformLocation(this.program,"u_is_offset"),m.u_is_offset?1:0),t.uniform2fv(t.getUniformLocation(this.program,"u_viewport_center"),m.u_viewport_center),t.uniform4fv(t.getUniformLocation(this.program,"u_viewport_center_projection"),m.u_viewport_center_projection),t.uniform1f(t.getUniformLocation(this.program,"u_project_scale"),m.u_project_scale),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree"),m.u_pixels_per_degree),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree2"),m.u_pixels_per_degree2)}onRemove(t,e){this.isLayerShow=!1}}function gt(t,e,i){var r,o=i||{},a=gt.providers,n=e.split("."),s=n[0],h=n[1],l=n[2],u=a[s][h][l],c=a[s].Subdomains,p=a[s][h].minzoom,f=a[s][h].maxzoom,m=a[s].tileType;if("Custom"===s&&(u=o.url?o.url:u,p=o.minzoom?o.minzoom:0,f=o.maxzoom?o.maxzoom:20),"TianDiTu"===s||"OSM"===s){var d=o.key||a[s].key,g=[];for(var _ of c)g.push(u.replace("{s}",_).replace("{key}",d));r={id:t,type:"raster",source:{type:"raster",tiles:g,tileSize:256,minzoom:p,maxzoom:f}}}else r=new dt(t,u,{subdomains:c,minZoom:p,maxZoom:f,tileType:m});return r}return gt.providers={TianDiTu:{Normal:{Map:"http://t{s}.tianditu.com/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Normal4326:{Map:"http://t{s}.tianditu.com/DataServer?T=vec_c&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cva_c&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Satellite:{Map:"http://t{s}.tianditu.com/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Satellite4326:{Map:"http://t{s}.tianditu.com/DataServer?T=img_c&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cia_c&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Terrain:{Map:"http://t{s}.tianditu.com/DataServer?T=ter_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cta_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:14},Subdomains:["0","1","2","3","4","5","6","7"],key:""},GaoDe:{Normal:{Map:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Normal_NoTag:{Map:"https://wprd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&scl=1&ltype=11&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Satellite:{Map:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",Annotion:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Subdomains:["1","2","3","4"]},Baidu:{Normal:{Map:"//online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1"},Satellite:{Map:"//shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46",Annotion:"//online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles=sl&v=020"},Subdomains:"0123456789",tileType:"bd09"},Geoq:{Normal:{Map:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}",PurplishBlue:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",Gray:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",Warm:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",minzoom:3,maxzoom:16},Subdomains:[]},OSM:{Normal:{Map:"//{s}.tile.osm.org/{z}/{x}/{y}.png",minzoom:0,maxzoom:18},Subdomains:["a","b","c"]},Custom:{WMTS:{URL:"custom/{z}/{x}/{y}.png",minzoom:0,maxzoom:20},TMS:{URL:"custom/{z}/{x}/{y}.png",minzoom:0,maxzoom:20},Subdomains:["0","1","2","3"]}},gt});