!function(e){var i={};function t(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=i,t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var r in e)t.d(o,r,function(i){return e[i]}.bind(null,r));return o},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="",t(t.s=3)}([function(e,i){e.exports=function(){try{return window.MapGISCommon}catch(e){return{}}}()},function(e,i){e.exports=function(){try{return window.L}catch(e){return{}}}()},function(e,i){e.exports=function(){try{return window.MapGISLeafletPlugin}catch(e){return{}}}()},function(e,i,t){"use strict";t.r(i);var o=t(0),r=t(1),n=t(2);class a{constructor(e){e=Object(o.defaultValue)(e,{}),this._videoRegisrationType=Object(o.defaultValue)(e.videoRegistrationType,null),this._calibrationParam=Object(o.defaultValue)(e.calibrationParam,void 0),this._cameraParam=Object(o.defaultValue)(e.cameraParam,void 0)}get videoRegistrationType(){return this._videoRegisrationType}get calibrationParam(){return this._calibrationParam}get cameraParam(){return this._cameraParam}}o.Zondy.VideoRegistrationParam=a;var s=a;class d{constructor(e){if(e=Object(o.defaultValue)(e,{}),this._videoID=Object(o.defaultValue)(e.videoID,null),this._videoName=Object(o.defaultValue)(e.videoName,null),this._videoSource=Object(o.defaultValue)(e.videoSource,null),this._videoSource){if(this._videoSource.videoUrl){switch(this._videoUrl=Object(o.defaultValue)(this._videoSource.videoUrl,null),this._videoProtocol=Object(o.defaultValue)(this._videoSource.protocol,null),this._videoProtocol){case o.VideoSourceType.mp4:this._videoProtocol=o.VideoSourceType.mp4;break;case o.VideoSourceType.hls:this._videoProtocol=o.VideoSourceType.hls;break;case o.VideoSourceType.rtmp:this._videoProtocol=o.VideoSourceType.rtmp;break;default:this._videoProtocol=null}this._videoProtocol||(this._videoProtocol=Object(o.getVideoType)(this._videoSource.videoUrl))}}else this._videoProtocol=null,this._videoUrl=null;const i=e.videoRegistrationParam?e.videoRegistrationParam:e;this._videoRegistrationParam=new s(i),this._videoMetaDataVersion=Object(o.defaultValue)(e.version,null)}get videoID(){return this._videoID}get videoName(){return this._videoName}get videoSource(){return this._videoSource}get videoRegistrationParam(){return this._videoRegistrationParam}}o.Zondy.VideoMetaData=d;var l=d;function h(e,i,t){t[1]=i[1]*e[1]+i[2]*e[4],t[2]=i[1]*e[2]+i[2]*e[5],t[0]=i[1]*e[0]+i[2]*e[3]+1*i[0],t[4]=i[4]*e[1]+i[5]*e[4],t[5]=i[4]*e[2]+i[5]*e[5],t[3]=i[4]*e[0]+i[5]*e[3]+1*i[3]}function c(e,i){if(0===e[2]&&0===e[4]&&0!==e[1]&&0!==e[5])return i[0]=-e[0]/e[1],i[1]=1/e[1],i[2]=0,i[3]=-e[3]/e[5],i[4]=0,i[5]=1/e[5],1;const t=e[1]*e[5]-e[2]*e[4],o=Math.max(Math.max(Math.abs(e[1]),Math.abs(e[2])),Math.max(Math.abs(e[4]),Math.abs(e[5])));if(Math.abs(t)<=1e-10*o*o)return 0;const r=1/t;return i[1]=e[5]*r,i[4]=-e[4]*r,i[2]=-e[2]*r,i[5]=e[1]*r,i[0]=(e[2]*e[3]-e[0]*e[5])*r,i[3]=(-e[1]*e[3]+e[0]*e[4])*r,1}function _(e,i,t){return{pdfGeoX:e[0]+i*e[1]+t*e[2],pdfGeoY:e[3]+i*e[4]+t*e[5]}}var v=class{constructor(){this._videoRegistrationParam=null,this._gdalGCPsData=[],this._toGeoTransforms=new Float64Array(6),this._invToGeoTransforms=new Float64Array(6),this._spatialReference=new o.SpatialReference("EPSG:4326")}init(e){this._videoRegistrationParam=new s(e),this._videoRegistrationParam.calibrationParam&&this._videoRegistrationParam.calibrationParam.groundControlPointList?(this._videoRegistrationParam.calibrationParam.groundControlPointList.forEach((e,i)=>{0===i&&e.spatialReference&&(this._spatialReference=e.spatialReference);let{x:t,y:r}=e;if(!this._spatialReference.isGeographic){const i=o.Projection.project(new o.Point({coordinates:[e.x,e.y],spatialReference:this._spatialReference}),new o.SpatialReference({wkid:4326}));t=i.coordinates[0],r=i.coordinates[1]}const n={pszId:e.id,pszInfo:e.description,dfGCPPixel:e.pixelX,dfGCPLine:e.pixelY,dfGCPX:t,dfGCPY:r,dfGCPZ:e.z};this._gdalGCPsData.push(n)}),function(e,i,t){let r=.25;t||(t=!0,r=.25);const n=e.length;if(n<2)return!1;if(2===n)return e[1].dfGCPPixel!==e[0].dfGCPPixel&&e[1].dfGCPLine!==e[0].dfGCPLine&&(i[1]=(e[1].dfGCPX-e[0].dfGCPX)/(e[1].dfGCPPixel-e[0].dfGCPPixel),i[2]=0,i[4]=0,i[5]=(e[1].dfGCPY-e[0].dfGCPY)/(e[1].dfGCPLine-e[0].dfGCPLine),i[0]=e[0].dfGCPX-e[0].dfGCPPixel*i[1]-e[0].dfGCPLine*i[2],i[3]=e[0].dfGCPY-e[0].dfGCPPixel*i[4]-e[0].dfGCPLine*i[5],!0);if(4===n&&e[0].dfGCPLine===e[1].dfGCPLine&&e[2].dfGCPLine===e[3].dfGCPLine&&e[0].dfGCPPixel===e[3].dfGCPPixel&&e[1].dfGCPPixel===e[2].dfGCPPixel&&e[0].dfGCPLine!==e[2].dfGCPLine&&e[0].dfGCPPixel!==e[1].dfGCPPixel&&e[0].dfGCPY===e[1].dfGCPY&&e[2].dfGCPY===e[3].dfGCPY&&e[0].dfGCPX===e[3].dfGCPX&&e[1].dfGCPX===e[2].dfGCPX&&e[0].dfGCPY!==e[2].dfGCPY&&e[0].dfGCPX!==e[1].dfGCPX)return i[1]=(e[1].dfGCPX-e[0].dfGCPX)/(e[1].dfGCPPixel-e[0].dfGCPPixel),i[2]=0,i[4]=0,i[5]=(e[2].dfGCPY-e[1].dfGCPY)/(e[2].dfGCPLine-e[1].dfGCPLine),i[0]=e[0].dfGCPX-e[0].dfGCPPixel*i[1],i[3]=e[0].dfGCPY-e[0].dfGCPLine*i[5],!0;let a=e[0].dfGCPPixel,s=e[0].dfGCPPixel,d=e[0].dfGCPLine,l=e[0].dfGCPLine,v=e[0].dfGCPX,f=e[0].dfGCPX,u=e[0].dfGCPY,p=e[0].dfGCPY;for(let i=1;i<n;++i)a=Math.min(a,e[i].dfGCPPixel),s=Math.max(s,e[i].dfGCPPixel),d=Math.min(d,e[i].dfGCPLine),l=Math.max(l,e[i].dfGCPLine),v=Math.min(v,e[i].dfGCPX),f=Math.max(f,e[i].dfGCPX),u=Math.min(u,e[i].dfGCPY),p=Math.max(p,e[i].dfGCPY);if(Math.abs(s-a)<1e-12||Math.abs(l-d)<1e-12||Math.abs(f-v)<1e-12||Math.abs(p-u)<1e-12)return!1;const P=new Float64Array(6),m=new Float64Array(6);P[0]=-a/(s-a),P[1]=1/(s-a),P[2]=0,P[3]=-d/(l-d),P[4]=0,P[5]=1/(l-d),m[0]=-v/(f-v),m[1]=1/(f-v),m[2]=0,m[3]=-u/(p-u),m[4]=0,m[5]=1/(p-u);let y=0,g=0,w=0,C=0,V=0,x=0,G=0,b=0,S=0,E=0,M=0;for(let i=0;i<n;++i){const{pdfGeoX:t,pdfGeoY:o}=_(P,e[i].dfGCPPixel,e[i].dfGCPLine),{pdfGeoX:r,pdfGeoY:n}=_(m,e[i].dfGCPX,e[i].dfGCPY);y+=t,g+=o,w+=t*o,C+=t*t,V+=o*o,x+=r,G+=r*t,b+=r*o,S+=n,E+=n*t,M+=n*o}const T=n*(C*V-w*w)+2*y*g*w-g*g*C-y*y*V;if(0===T)return!1;const L=new Float64Array(6);L[0]=(x*(C*V-w*w)+G*(g*w-y*V)+b*(y*w-g*C))/T,L[3]=(S*(C*V-w*w)+E*(g*w-y*V)+M*(y*w-g*C))/T,L[1]=(x*(g*w-y*V)+G*(n*V-g*g)+b*(y*g-w*n))/T,L[2]=(x*(y*w-g*C)+G*(y*g-n*w)+b*(n*C-y*y))/T,L[4]=(S*(g*w-y*V)+E*(n*V-g*g)+M*(y*g-w*n))/T,L[5]=(S*(y*w-g*C)+E*(y*g-n*w)+M*(n*C-y*y))/T;const k=new Float64Array(6),H=new Float64Array(6);if(!c(m,H))return!1;if(h(P,L,k),h(k,H,i),t){const t=.5*(Math.abs(i[1])+Math.abs(i[2])+Math.abs(i[4])+Math.abs(i[5]));if(0===t)return o.Log.info("dfPixelSize = 0"),!1;for(let a=0;a<n;a++){const n=e[a].dfGCPPixel*i[1]+e[a].dfGCPLine*i[2]+i[0]-e[a].dfGCPX,s=e[a].dfGCPPixel*i[4]+e[a].dfGCPLine*i[5]+i[3]-e[a].dfGCPY;if(Math.abs(n)>r*t||Math.abs(s)>r*t)return o.Log.info(`dfErrorX/dfPixelSize = ${Math.abs(n)/t}, dfErrorY/dfPixelSize = ${Math.abs(s)/t}`),!1}}}(this._gdalGCPsData,this._toGeoTransforms,!0),c(this._toGeoTransforms,this._invToGeoTransforms)):o.Log.error("缺少标定配准转换数据")}pixelCoordToGeoCoord(e){const{pdfGeoX:i,pdfGeoY:t}=_(this._toGeoTransforms,e.x,e.y);return new o.Point({coordinates:[i,t]})}geoCoordToPixelCoord(e){const{pdfGeoX:i,pdfGeoY:t}=_(this._invToGeoTransforms,e.coordinates[0],e.coordinates[1]);return{x:i,y:t}}};class f{}f.getMouseEvent=function(e,i,t){const r=i._spatialReference;let n=void 0;const a=i.toMap({x:e.latlng.lng,y:e.latlng.lat});return{mapPoint:n=r&&!r.isGeographic?o.Projection.project(a,r):a,x:e.containerPoint.x,y:e.containerPoint.y,button:e.originalEvent.button,buttons:e.originalEvent.buttons,stopPropagation:e.originalEvent.stopPropagation,timeStamp:e.originalEvent.timeStamp,native:e.originalEvent,type:t}},f.getKeyEvent=function(e,i,t){const o={key:e.originalEvent.key,stopPropagation:e.originalEvent.stopPropagation,timeStamp:e.originalEvent.timeStamp,native:e.originalEvent,type:t};return"key-down"===t&&(o.repeat=e.originalEvent.repeat),o},f.getViewChangeEvent=function(e,i,t){const o={event:e,target:i,type:t};return o.mapView=i,o.scale=i._scale,o.zoom=i._zoom,o.center=i.center,o.extent=i._extent,o},f.getDragEvent=function(e,i,t,o,r){return{x:e.originalEvent.layerX,y:e.originalEvent.layerY,button:void 0!==r?r:e.originalEvent.button,buttons:e.originalEvent.buttons,cancelable:e.originalEvent.cancelable,origin:t,stopPropagation:e.originalEvent.stopPropagation,timeStamp:e.originalEvent.timeStamp,native:e.originalEvent,action:o,type:"drag"}};var u=f;var p=class extends o.LayerView{onAdd(){const e=this.layer,i=this.innerView;return this.view._initVideoMetaData(e.source),this._videoMapViewContainer=document.getElementById(this.view._viewId),this.innerLayer=this._addVideoMapInnerLayer(e,i,{view:this.view}),this.innerLayer.commonLayerId=e.id,new Promise(i=>{this.innerLayer.then(()=>{this._addInnerLayerDOM(e),i(this)})})}onRemove(){return this._hlsPlayer&&(this._hlsPlayer.dispose(),this._hlsPlayer=void 0),this._rtmpPlayer&&(this._rtmpPlayer.dispose(),this._rtmpPlayer=void 0),this._videoHtml&&(this._videoHtml.remove(),this._videoHtml=void 0),this.layer=void 0,Promise.resolve(this)}_addVideoMapInnerLayer(e,i,t){this.url=e.url;const r=this.layer.source.videoSource.videoUrl,n=Object(o.getVideoType)(r);return new Promise((e,i)=>{if(n!==o.VideoSourceType.videoPlayer){if(n===o.VideoSourceType.videoHTML)return this._width=r.videoWidth,this._height=r.videoHeight,void e(this);this._videoHtml=document.createElement("video"),this._videoHtml.id="video",this._videoHtml.style.position="absolute",this._videoHtml.style.zIndex="0",this._videoMapViewContainer.appendChild(this._videoHtml),this._videoHtml.style.width="100%",this._videoHtml.style.height="100%",n===o.VideoSourceType.mp4?(this._videoHtml.crossOrigin="anonymous",this._videoHtml.autoplay=!0,this._videoHtml.loop=!0,this._videoHtml.src=r,this._videoHtml.play(),this._videoHtml.controls=!0):n===o.VideoSourceType.hls?(this._hlsPlayer=videojs(this._videoHtml,{fluid:!0}),this._hlsPlayer.src({type:"application/x-mpegURL",src:r}),this._hlsPlayer.load(r),this._hlsPlayer.play(),this._hlsPlayer.loop(!0),this._hlsPlayer.el().querySelector("video").controls=!0):n===o.VideoSourceType.rtmp&&(this._rtmpPlayer=videojs(this._videoHtml,{sources:[{src:r,type:"rtmp/flv"}],fluid:!0},()=>{this._rtmpPlayer.play(),this._rtmpPlayer.loop(!0)}),this._rtmpPlayer.on("play",()=>{this._rtmpPlayer.width(this._rtmpPlayer.videoWidth()),this._rtmpPlayer.height(this._rtmpPlayer.videoHeight()),this._videoHtml.onloadeddata()})),this._videoHtml.onloadeddata=(()=>{this.loadStatus=o.LoadStatus.loaded,this.loaded=!0,this._width=this._videoHtml.videoWidth?this._videoHtml.videoWidth:this._rtmpPlayer?this._rtmpPlayer.videoWidth():1,this._height=this._videoHtml.videoHeight?this._videoHtml.videoHeight:this._rtmpPlayer?this._rtmpPlayer.videoHeight():1,this.fire("layerview-created",{}),this._videoHtml.style.width=this._width,this._videoHtml.style.height=this._height,e(this)}),this._videoHtml.onerror=(()=>{let e="未知错误";switch(this._videoHtml.error.code){case 1:e="视频加载中断";break;case 2:e="网络链接错误";break;case 3:e="视频解码失败";break;case 4:e="不支持的视频"}o.Log.error(`出现错误：${e}错误代码：${this._videoHtml.error.code}`),this.loadStatus=o.LoadStatus.failed,i(this._videoHtml.error)})}else r.on("play",()=>{this._width=r.videoWidth(),this._height=r.videoHeight(),e(this)})})}_addInnerLayerDOM(){const e=this._videoHtml,i=this._width,t=this._height,{width:o,height:r,left:n,top:a,scale:s}=function(e,i,t){const o=t.clientWidth,r=t.clientHeight,n=Math.min(o/e,r/i),a=e*n,s=i*n;return{width:a,height:s,left:(o-a)/2,top:(r-s)/2,scale:n}}(i,t,this._videoMapViewContainer);this._videoPixelScale=s,this.view._videoPixelScale=s,e&&(e.style.left=`${n}px`,e.style.top=`${a}px`,e.style.width=`${o}px`,e.style.height=`${r}px`),this._fabricCanvas||(this._fabricContainer=document.createElement("div"),this._fabricContainer.id="fabricContainer",this._fabricContainer.style.position="absolute",this._fabricContainer.style.top=`${a}px`,this._fabricContainer.style.left=`${n}px`,this._fabricContainer.style.width=`${o}px`,this._fabricContainer.style.height=`${r}px`,this._videoMapViewContainer.appendChild(this._fabricContainer),this._fabricContainer.style.pointerEvents="none")}onUpdate(e){return Promise.resolve(this)}};class P extends o.BaseView{constructor(e){super(e),e=Object(o.defaultValue)(e,{}),this._viewId=e.viewId,this._mapViewId=`${this._viewId}-video-map-view`,this._videoMapViewContainer=document.getElementById(this._viewId),this._spatialReference=null,this.engineType="video",this.popup=Object(o.defaultValue)(e.popup,void 0),this._waitAddEventStorage=[]}_processLayerLoad(e){if(!e)return;const{addDetail:i}=e;this._prePromise||(this._prePromise=Promise.resolve()),this._prePromise=this._prePromise.then(()=>this._loadInnerView(i).then(()=>(this._waitAddEventStorage=this._waitAddEventStorage.concat(i),Object(o.allSettled)(this._waitAddEventStorage.map((e,i)=>{const{added:t,sourceTarget:o}=e,r=this._findGroupLayerViewById(o.id);let n;if(r){const e=t.filter(e=>"video"!==e.type);n=r.addMany(e).then(e=>{r._fireLayerViewCreatedByLayerViews(e),r._reorderByLayerViews&&r._reorderByLayerViews(e)})}else n=null;return this._waitAddEventStorage.length===i&&(this._waitAddEventStorage=[]),n})))).catch(e=>{o.Log.info(e)}))}_loadInnerView(e){let i,t;return new Promise((o,r)=>{if(this._innerView)o();else{for(const o in e){const r=e[o],{added:n,sourceTarget:a}=r;for(const e in n){"video"===n[e].type&&(i=n[e],t=this._findGroupLayerViewById(a.id));break}if(i)break}i?t.addMany([i]).then(e=>{t._fireLayerViewCreatedByLayerViews(e),t._reorderByLayerViews&&t._reorderByLayerViews(e),this._initView(),o()}):(this._waitAddEventStorage=this._waitAddEventStorage.concat(e),r("请先添加一个VideoMapLayer图层！"))}})}_destroyInnerView(){this._innerView&&(this._innerView.remove(),this._innerView=null)}_initView(){this._getContainerSize();const e=r.CRS.Simple;e.transformation=new r.Transformation(1,0,1,0),e.projection.project=(e=>{const i=this._videoPixelCoordTransforms.geoCoordToPixelCoord(new o.Point({coordinates:[e.lng,e.lat]})),t={x:i.x*this._videoPixelScale,y:i.y*this._videoPixelScale};return new r.Point(t.x,t.y)}),e.projection.unproject=(e=>{const i={x:e.x/this._videoPixelScale,y:e.y/this._videoPixelScale},t=this._videoPixelCoordTransforms.pixelCoordToGeoCoord(i);return new r.LatLng(t.coordinates[1],t.coordinates[0])});this._innerView=r.map("fabricContainer",{crs:e,attributionControl:!1,zoomControl:!1,doubleClickZoom:!1,dragging:!1,trackResize:!1,keyboard:!1,scrollWheelZoom:!1,rotate:!1}),this._disableInnerViewAction(),this._innerView.whenReady(()=>{this._getSize(),this._initPopup();const e=this.toMap({x:0,y:0}),i=this.toMap({x:this.width,y:0}),t=this.toMap({x:this.width,y:this.height}),o=this.toMap({x:0,y:this.height}),r=Math.max(e.coordinates[0],i.coordinates[0],t.coordinates[0],o.coordinates[0]),n=Math.min(e.coordinates[0],i.coordinates[0],t.coordinates[0],o.coordinates[0]),a=Math.max(e.coordinates[1],i.coordinates[1],t.coordinates[1],o.coordinates[1]),s=[[Math.min(e.coordinates[1],i.coordinates[1],t.coordinates[1],o.coordinates[1]),n],[a,r]];this._innerView.fitBounds(s),this._innerView._container.style.backgroundColor="#00000000",this._initViewEvent()});const i=this.toMap({x:0,y:0});this._innerView.setView([i.coordinates[1],i.coordinates[0]],0)}_initVideoMetaData(e){const i=Object(o.defaultValue)(e,{});this._videoPixelCoordTransforms||(this._videoPixelCoordTransforms=new v),this._videoMetaData=new l(i),this._videoPixelCoordTransforms.init(this._videoMetaData.videoRegistrationParam),this._spatialReference=this._videoPixelCoordTransforms._spatialReference}_initViewEvent(){const e=this;this._clickStore=null,this._dragParams={isDrag:!1,origin:null,action:"",button:null,dragMouseUp:!1},e.fire(o.ViewEventType.loaded,{}),this._innerView.on("click",i=>{e._dragParams.dragMouseUp?e._dragParams.dragMouseUp=!1:(e._clickStore=setTimeout(function(){e._clickStore&&e.fire(o.ViewEventType.click,u.getMouseEvent(i,e))},300),e.fire(o.ViewEventType.immediateClick,u.getMouseEvent(i,e)))}),this._innerView.on("contextmenu",i=>{e._clickStore=setTimeout(function(){e._clickStore&&e.fire(o.ViewEventType.click,u.getMouseEvent(i,e))},300),e.fire(o.ViewEventType.immediateClick,u.getMouseEvent(i,e))}),this._innerView.on("dblclick",i=>{e._clickStore&&(clearTimeout(this._clickStore),e._clickStore=null),e.fire(o.ViewEventType.doubleClick,u.getMouseEvent(i,e))}),this._innerView.on("mousedown",i=>{e.fire(o.ViewEventType.pointerDown,u.getMouseEvent(i,e)),this._dragParams.isDrag||(this._dragParams.origin={x:i.originalEvent.layerX,y:i.originalEvent.layerY},this._dragParams.button=i.originalEvent.button,this._dragParams.action="mouse-down",this._dragParams.isDrag=!1)}),this._innerView.on("mouseup",i=>{e.fire(o.ViewEventType.pointerUp,u.getMouseEvent(i,e)),e._dragParams.isDrag&&"update"===this._dragParams.action&&(this._dragParams.action="end",this._innerView.dragging._enabled||(e._dragParams.dragMouseUp=!0),e.fire(o.ViewEventType.drag,u.getDragEvent(i,e,e._dragParams.origin,this._dragParams.action))),e._dragParams.isDrag=!1,e._dragParams.origin=null,e._dragParams.action="",e._dragParams.button=null}),this._innerView.on("mousemove",i=>{e.fire(o.ViewEventType.pointerMove,u.getMouseEvent(i,e)),e._dragParams.isDrag?(e.fire(o.ViewEventType.drag,u.getDragEvent(i,e,e._dragParams.origin,e._dragParams.action,e._dragParams.button)),e._dragParams.action="update"):"mouse-down"===this._dragParams.action&&(this._dragParams.action="start",e._dragParams.isDrag=!0)}),this._innerView.on("keydown",i=>{e.fire(o.ViewEventType.keyDown,u.getKeyEvent(i,e,o.ViewEventType.keyDown))}),this._innerView.on("keyup",i=>{e.fire(o.ViewEventType.keyUp,u.getKeyEvent(i,e,o.ViewEventType.keyUp))}),this._innerView.on("movestart",()=>{e.stationary=!1}),this._innerView.on("zoom",i=>{e.fire(o.ViewEventType.zoom,{zoom:i.target._zoom,event:i})}),this._innerView.on("zoomend",i=>{e.fire(o.ViewEventType.viewChange,u.getViewChangeEvent(i,e))}),this._innerView.on("moveend",i=>{e.fire(o.ViewEventType.viewChange,u.getViewChangeEvent(i,e)),e.stationary=!0}),this._innerView.on("resize",i=>{e.fire(o.ViewEventType.resize,{oldWidth:i.oldSize.x,oldHeight:i.oldSize.y,width:i.newSize.x,height:i.newSize.y}),e._initSize()}),this.fire(o.ViewEventType.viewCreated,this._innerView)}_initPopup(){this.popup=new n.Popup({view:this})}_initSize(){}toMap(e){let i;if(this._videoPixelCoordTransforms){const t={x:e.x/this._videoPixelScale,y:e.y/this._videoPixelScale};i=this._videoPixelCoordTransforms.pixelCoordToGeoCoord(t)}else i=new o.Point({coordinates:[e.x,e.y]});return i}toScreen(e){let i;if(this._videoPixelCoordTransforms){const t=this._videoPixelCoordTransforms.geoCoordToPixelCoord(e);i={x:t.x*this._videoPixelScale,y:t.y*this._videoPixelScale}}else i={x:e[0],y:e[1]};return i}_mapActionControl(e,i){this._innerView&&"video-map-active"===e&&(document.getElementById("fabricContainer").style.pointerEvents=i?"auto":"none")}_getSize(){const e=this._innerView.getSize();this.width=e.x,this.height=e.y}_getContainerSize(){const e=document.getElementById(this._viewId);this.width=e.clientWidth,this.height=e.clientHeight}_disableInnerViewAction(){this._innerView.dragging.disable(),this._innerView.doubleClickZoom.disable(),this._innerView.scrollWheelZoom=!1}_createLayerView(e){let i;return"video"===e.type?i=new p({view:this,layer:e}):e.type!==o.LayerType.graphics&&e.type!==o.LayerType.geojson||(i=Object(n.getLayerView)(this,e)),i}flyTo(){}}Object.defineProperties(P.prototype,{viewId:{get(){return this._viewId},set(){}},spatialReference:{get(){return this._spatialReference},set(){}}});var m=P;var y=class extends n.SketchEditorLeaflet{constructor(e){super(e)}};t.d(i,"VideoMapView",function(){return m}),t.d(i,"MapView",function(){return m}),t.d(i,"VideoSketchEditor",function(){return y}),t.d(i,"SketchEditor",function(){return y}),o.zondy.video={},o.zondy.video.MapView=m,o.zondy.video.tool={},o.zondy.video.tool.sketch={},o.zondy.video.tool.sketch.SketchEditor=y,o.zondy.video.VERSION="17.4.0",o.Zondy.VideoMapView=m,o.Zondy.VideoSketchEditor=y,o.Zondy.VideoPluginVersion=o.zondy.video.VERSION}]);