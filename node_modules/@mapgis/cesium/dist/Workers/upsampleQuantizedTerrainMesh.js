define(["./AttributeCompression-2f7b45b7","./Transforms-c1a1d063","./Matrix2-59fd2efe","./when-ae2e0b60","./TerrainEncoding-11b6c30f","./IndexDatatype-6902a37d","./RuntimeError-24b14c10","./ComponentDatatype-b7b5db18","./OrientedBoundingBox-f3e4df94","./createTaskProcessorWorker","./combine-276652d0","./WebGLConstants-35626ea2","./EllipsoidTangentPlane-4a503a7a","./AxisAlignedBoundingBox-9c01642b","./IntersectionTests-60f10d18","./Plane-43337cee"],function(s,ue,oe,c,pe,de,n,ae,fe,e,o,p,d,a,f,l){var le={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,r){c.defined(r)?r.length=0:r=[],t=t?(h=i<e,u=n<e,s<e):(h=e<i,u=e<n,e<s);var h,u,o,p,d,a,f,l,g=h+u+t;return 1===g?h?(o=(e-i)/(n-i),p=(e-i)/(s-i),r.push(1),r.push(2),1!==p&&(r.push(-1),r.push(0),r.push(2),r.push(p)),1!==o&&(r.push(-1),r.push(0),r.push(1),r.push(o))):u?(d=(e-n)/(s-n),a=(e-n)/(i-n),r.push(2),r.push(0),1!==a&&(r.push(-1),r.push(1),r.push(0),r.push(a)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):t&&(f=(e-s)/(i-s),l=(e-s)/(n-s),r.push(0),r.push(1),1!==l&&(r.push(-1),r.push(2),r.push(1),r.push(l)),1!==f)&&(r.push(-1),r.push(2),r.push(0),r.push(f)):2===g?h||i===e?u||n===e?t||s===e||(p=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(p),r.push(-1),r.push(1),r.push(2),r.push(d)):(l=(e-s)/(n-s),o=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(l),r.push(-1),r.push(0),r.push(1),r.push(o)):(a=(e-n)/(i-n),f=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(a),r.push(-1),r.push(2),r.push(0),r.push(f)):3!==g&&(r.push(0),r.push(1),r.push(2)),r},computeBarycentricCoordinates:function(e,t,i,n,s,r,h,u,o){var i=i-h,s=h-s,r=r-u,n=n-u,p=1/(r*i+s*n),t=t-u,u=e-h,e=(r*u+s*t)*p,h=(-n*u+i*t)*p,r=1-e-h;return c.defined(o)?(o.x=e,o.y=h,o.z=r,o):new oe.Cartesian3(e,h,r)},computeLineSegmentLineSegmentIntersection:function(e,t,i,n,s,r,h,u,o){var p=(h-s)*(t-r)-(u-r)*(e-s),d=(i-e)*(t-r)-(n-t)*(e-s),u=(u-r)*(i-e)-(h-s)*(n-t);if(0!=u)return r=d/u,0<=(h=p/u)&&h<=1&&0<=r&&r<=1?((o=c.defined(o)?o:new oe.Cartesian2).x=e+h*(i-e),o.y=t+h*(n-t),o):void 0}},ge=32767,ce=16383,me=[],xe=[],we=[],Ce=new oe.Cartographic,ve=new oe.Cartesian3,Be=[],ye=[],Ie=[],be=[],Ae=[],Te=new oe.Cartesian3,ze=new ue.BoundingSphere,Me=new fe.OrientedBoundingBox,Ne=new oe.Cartesian2,Ve=new oe.Cartesian3;function Ee(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}Ee.prototype.clone=function(e){return(e=c.defined(e)?e:new Ee).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},Ee.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},Ee.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],this.second=i[e[++n]],this.ratio=e[++n],++n),n},Ee.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},Ee.prototype.isIndexed=function(){return c.defined(this.index)},Ee.prototype.getH=function(){return c.defined(this.index)?this.heightBuffer[this.index]:ae.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},Ee.prototype.getU=function(){return c.defined(this.index)?this.uBuffer[this.index]:ae.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},Ee.prototype.getV=function(){return c.defined(this.index)?this.vBuffer[this.index]:ae.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var t=new oe.Cartesian2,r=-1,h=[new oe.Cartesian3,new oe.Cartesian3],u=[new oe.Cartesian3,new oe.Cartesian3];function i(e,t){var i=h[++r],n=u[r],i=s.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=s.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),n);return ve=oe.Cartesian3.lerp(i,n,e.ratio,ve),oe.Cartesian3.normalize(ve,ve),s.AttributeCompression.octEncode(ve,t),--r,t}Ee.prototype.getNormalX=function(){return c.defined(this.index)?this.normalBuffer[2*this.index]:(t=i(this,t)).x},Ee.prototype.getNormalY=function(){return c.defined(this.index)?this.normalBuffer[2*this.index+1]:(t=i(this,t)).y};var m=[];function Re(e,t,i,n,s,r,h,u,o){if(0!==h.length){for(var p=0,d=0;d<h.length;)d=m[p++].initializeFromClipResult(h,d,u);for(var a=0;a<p;++a){var f,l,g=m[a];g.isIndexed()?(g.newIndex=r[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,o&&(g.normalBuffer=n)):(f=g.getKey(),c.defined(r[f])?g.newIndex=r[f]:(l=e.length,e.push(g.getU()),t.push(g.getV()),i.push(g.getH()),o&&(n.push(g.getNormalX()),n.push(g.getNormalY())),g.newIndex=l,r[f]=l))}3===p?(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex)):4===p&&(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex),s.push(m[0].newIndex),s.push(m[2].newIndex),s.push(m[3].newIndex))}}return m.push(new Ee),m.push(new Ee),m.push(new Ee),m.push(new Ee),e(function(e,U){for(var t=e.isEastChild,i=e.isNorthChild,F=t?ce:0,P=t?ge:ce,D=i?ce:0,W=i?ge:ce,n=Be,s=ye,r=Ie,h=Ae,u=(n.length=0,s.length=0,r.length=0,h.length=0,be),o=(u.length=0,{}),p=e.vertices,d=(d=e.indices).subarray(0,e.indexCountWithoutSkirts),a=pe.TerrainEncoding.clone(e.encoding),f=a.hasVertexNormals,X=0,l=e.vertexCountWithoutSkirts,g=e.minimumHeight,k=e.maximumHeight,c=new Array(l),m=new Array(l),x=new Array(l),w=f?new Array(2*l):void 0,C=0,v=0;C<l;++C,v+=2){var B=a.decodeTextureCoordinates(p,C,Ne),y=a.decodeHeight(p,C),I=ae.CesiumMath.clamp(B.x*ge|0,0,ge),b=ae.CesiumMath.clamp(B.y*ge|0,0,ge);x[C]=ae.CesiumMath.clamp((y-g)/(k-g)*ge|0,0,ge),ge-(I=I<20?0:I)<20&&(I=ge),ge-(b=b<20?0:b)<20&&(b=ge),c[C]=I,m[C]=b,f&&(B=a.getOctEncodedNormal(p,C,Ve),w[v]=B.x,w[v+1]=B.y),(t&&ce<=I||!t&&I<=ce)&&(i&&ce<=b||!i&&b<=ce)&&(o[C]=X,n.push(I),s.push(b),r.push(x[C]),f&&(h.push(w[v]),h.push(w[v+1])),++X)}var A=[],T=(A.push(new Ee),A.push(new Ee),A.push(new Ee),[]);for(T.push(new Ee),T.push(new Ee),T.push(new Ee),C=0;C<d.length;C+=3){var z=d[C],M=d[C+1],K=d[C+2],L=c[z],Y=c[M],_=c[K],z=(A[0].initializeIndexed(c,m,x,w,z),A[1].initializeIndexed(c,m,x,w,M),A[2].initializeIndexed(c,m,x,w,K),le.clipTriangleAtAxisAlignedThreshold(ce,t,L,Y,_,me));z.length<=0||(M=T[0].initializeFromClipResult(z,0,A))>=z.length||(M=T[1].initializeFromClipResult(z,M,A))>=z.length||(M=T[2].initializeFromClipResult(z,M,A),Re(n,s,r,h,u,o,le.clipTriangleAtAxisAlignedThreshold(ce,i,T[0].getV(),T[1].getV(),T[2].getV(),xe),T,f),M<z.length&&(T[2].clone(T[1]),T[2].initializeFromClipResult(z,M,A),Re(n,s,r,h,u,o,le.clipTriangleAtAxisAlignedThreshold(ce,i,T[0].getV(),T[1].getV(),T[2].getV(),xe),T,f)))}var G=t?-ge:0,J=i?-ge:0,Z=[],j=[],q=[],Q=[],N=Number.MAX_VALUE,V=-N,E=we,R=(E.length=0,oe.Ellipsoid.clone(e.ellipsoid)),$=(e=oe.Rectangle.clone(e.childRectangle)).north,ee=e.south,H=e.east,te=e.west;for(H<te&&(H+=ae.CesiumMath.TWO_PI),C=0;C<n.length;++C)I=(I=Math.round(n[C]))<=F?(Z.push(C),0):P<=I?(q.push(C),ge):2*I+G,n[C]=I,b=(b=Math.round(s[C]))<=D?(j.push(C),0):W<=b?(Q.push(C),ge):2*b+J,s[C]=b,(y=ae.CesiumMath.lerp(g,k,r[C]/ge))<N&&(N=y),V<y&&(V=y),r[C]=y,Ce.longitude=ae.CesiumMath.lerp(te,H,I/ge),Ce.latitude=ae.CesiumMath.lerp(ee,$,b/ge),Ce.height=y,R.cartographicToCartesian(Ce,ve),E.push(ve.x),E.push(ve.y),E.push(ve.z);var ie=ue.BoundingSphere.fromVertices(E,oe.Cartesian3.ZERO,3,ze),e=fe.OrientedBoundingBox.fromRectangle(e,N,V,R,Me),ne=new pe.EllipsoidalOccluder(R).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ie.center,E,3,ie.center,N,Te),se=V-N,O=new Uint16Array(n.length+s.length+r.length);for(C=0;C<n.length;++C)O[C]=n[C];var re=n.length;for(C=0;C<s.length;++C)O[re+C]=s[C];for(re+=s.length,C=0;C<r.length;++C)O[re+C]=ge*(r[C]-N)/se;var S,he=de.IndexDatatype.createTypedArray(n.length,u);return f?(S=new Uint8Array(h),U.push(O.buffer,he.buffer,S.buffer),S=S.buffer):U.push(O.buffer,he.buffer),{vertices:O.buffer,encodedNormals:S,indices:he.buffer,minimumHeight:N,maximumHeight:V,westIndices:Z,southIndices:j,eastIndices:q,northIndices:Q,boundingSphere:ie,orientedBoundingBox:e,horizonOcclusionPoint:ne}})});
